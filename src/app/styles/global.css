@import 'tailwindcss';
@plugin "@tailwindcss/typography";

@theme {
	--font-sans: 'Inter', sans-serif;
	--font-serif: 'Inter', serif;
	--font-display: 'Crimson Text', serif;

	/* Semantic Color Mapping */
	--color-background: var(--background);
	--color-foreground: var(--foreground);
	--color-card: var(--card);
	--color-card-foreground: var(--card-foreground);
	--color-popover: var(--popover);
	--color-popover-foreground: var(--popover-foreground);
	--color-primary: var(--primary);
	--color-primary-foreground: var(--primary-foreground);
	--color-secondary: var(--secondary);
	--color-secondary-foreground: var(--secondary-foreground);
	--color-muted: var(--muted);
	--color-muted-foreground: var(--muted-foreground);
	--color-accent: var(--accent);
	--color-accent-foreground: var(--accent-foreground);
	--color-destructive: var(--destructive);
	--color-destructive-foreground: var(--destructive-foreground);
	--color-border: var(--border);
	--color-input: var(--input);
	--color-ring: var(--ring);
}

@layer base {
	* {
		@apply border-border;
	}
	html,
	body,
	#root {
		height: 100%;
		height: 100dvh;
		overflow: hidden;
		overscroll-behavior: none;
		-webkit-tap-highlight-color: transparent;
	}
	body {
		@apply bg-background text-foreground antialiased font-sans;
	}
	/* Heading Defaults */
	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		@apply font-serif font-bold text-foreground;
	}
}

/* --- THEME DEFINITIONS --- */

/* LIGHT MODE */
:root {
	--background: #ffffff;
	--foreground: #09090b;
	--card: #ffffff;
	--card-foreground: #09090b;
	--popover: #ffffff;
	--popover-foreground: #09090b;
	--primary: #d97706;
	--primary-foreground: #ffffff;
	--secondary: #f4f4f5;
	--secondary-foreground: #18181b;
	--muted: #f4f4f5;
	--muted-foreground: #71717a;
	--accent: #f4f4f5;
	--accent-foreground: #18181b;
	--destructive: #ef4444;
	--destructive-foreground: #fafafa;
	--border: #e4e4e7;
	--input: #e4e4e7;
	--ring: #d97706;
	--radius: 0.5rem;
}

/* DARK MODE (Zinc) */
[data-theme='dark'] {
	--background: rgb(17 17 17);
	--foreground: #eee;
	--card: #18181b;
	--card-foreground: #fafafa;
	--popover: #18181b;
	--popover-foreground: #fafafa;
	--primary: #f59e0b;
	--primary-foreground: #09090b;
	--secondary: #27272a;
	--secondary-foreground: #fafafa;
	--muted: #1c1c1f;
	--muted-foreground: #a1a1aa;
	--accent: #27272a;
	--accent-foreground: #fafafa;
	--destructive: #ef4444;
	--destructive-foreground: #fafafa;
	--border: #27272a;
	--input: #27272a;
	--ring: #f59e0b;
}

/* D&D MODE (Parchment) */
[data-theme='dnd'] {
	--background: #fdfbf7;
	--foreground: #2c1a11;
	--card: #fdfbf7;
	--card-foreground: #1b1b1b;
	--popover: #fdfbf7;
	--popover-foreground: #1b1b1b;
	--primary: #d97706; /* Amber-600 */
	--primary-foreground: #ffffff;
	--secondary: #f2efe9;
	--secondary-foreground: #1b1b1b;
	--muted: #f2efe9;
	--muted-foreground: #5f5a52;
	--accent: #f2efe9;
	--accent-foreground: #1b1b1b;
	--destructive: #991b1b;
	--destructive-foreground: #ffffff;
	--border: #cecece;
	--input: #c9c2b8;
	--ring: #8b1e1e;

	--entity-session: #5f5a52;
	--entity-character: #c10007; /* Deep blood red */
	--entity-npc: #bb4d00; /* Burnt Sienna */
	--entity-location: #007a55; /* Deep Forest/Moss green */
	--entity-quest: #1447e6; /* Deep Navy ink */
	--entity-faction: #8200db; /* Royal Plum ink */
	--entity-encounter: #ca3500; /* Iron Oxide */

	text-rendering: optimizeLegibility;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

[data-theme='dnd'] .prose,
[data-theme='dnd'] body {
	text-shadow: 0 0 0.15px rgba(44, 26, 17, 0.1);
}

/* D&D Mode Texture */
[data-theme='dnd'] .bg-background {
	background-color: var(--background);
	background-image: var(--bg-texture, none);
	background-repeat: repeat;
}

[data-theme='dnd'] .bg-muted {
	background-color: var(--muted);
	border-right-color: #c9c2b8;
}

/* --- TYPOGRAPHY (Prose) --- */
.prose {
	--tw-prose-body: var(--foreground);
	--tw-prose-headings: var(--foreground);
	--tw-prose-lead: var(--muted-foreground);
	--tw-prose-links: var(--primary);
	--tw-prose-bold: var(--foreground);
	--tw-prose-counters: var(--muted-foreground);
	--tw-prose-bullets: var(--primary);
	--tw-prose-hr: var(--border);
	--tw-prose-quotes: var(--foreground);
	--tw-prose-quote-borders: var(--primary);
	--tw-prose-captions: var(--muted-foreground);
	--tw-prose-code: var(--foreground);
	--tw-prose-pre-code: var(--foreground);
	--tw-prose-pre-bg: var(--muted);
	--tw-prose-th-borders: var(--border);
	--tw-prose-td-borders: var(--border);

	font-family: var(--font-sans);
	max-width: none;
}

/* Prose Dark Mode Overrides */
[data-theme='dark'] .prose {
	--tw-prose-body: var(--foreground);
	--tw-prose-headings: var(--foreground);
	--tw-prose-lead: var(--muted-foreground);
	--tw-prose-links: var(--primary);
	--tw-prose-bold: var(--foreground);
	--tw-prose-counters: var(--muted-foreground);
	--tw-prose-bullets: var(--primary);
	--tw-prose-hr: var(--border);
	--tw-prose-quotes: var(--muted-foreground);
	--tw-prose-quote-borders: var(--primary);
	--tw-prose-captions: var(--muted-foreground);
	--tw-prose-code: var(--accent-foreground);
	--tw-prose-pre-code: var(--accent-foreground);
	--tw-prose-pre-bg: var(--card);
	--tw-prose-th-borders: var(--border);
	--tw-prose-td-borders: var(--border);
}

/* D&D Mode Prose Styling */
[data-theme='dnd'] .prose h1,
[data-theme='dnd'] .prose h2,
[data-theme='dnd'] .prose h3 {
	font-family: var(--font-serif);
	color: var(--foreground);
	border-bottom-color: var(--border);
}

/* --- SCROLLBAR --- */
.custom-scrollbar::-webkit-scrollbar {
	width: 6px;
	height: 6px;
}
.custom-scrollbar::-webkit-scrollbar-track {
	background: transparent;
}
.custom-scrollbar::-webkit-scrollbar-thumb {
	background: var(--border);
	border-radius: 99px;
}
.custom-scrollbar::-webkit-scrollbar-thumb:hover {
	background: var(--muted-foreground);
}

/* --- SAFE AREA INSETS --- */
.pt-safe {
	padding-top: env(safe-area-inset-top, 20px);
}
.pb-safe {
	padding-bottom: env(safe-area-inset-bottom, 20px);
}
.pl-safe {
	padding-left: env(safe-area-inset-left, 0px);
}
.pr-safe {
	padding-right: env(safe-area-inset-right, 0px);
}

/* --- COMPREHENSIVE COMPATIBILITY OVERRIDES --- */

/* Background Colors */
.bg-white {
	background-color: var(--card) !important;
}
.bg-gray-50,
.bg-slate-50,
.bg-stone-50,
.bg-zinc-50 {
	background-color: var(--muted) !important;
}
.bg-gray-100,
.bg-slate-100,
.bg-stone-100,
.bg-zinc-100 {
	background-color: var(--muted) !important;
}
.bg-gray-200,
.bg-slate-200,
.bg-stone-200,
.bg-zinc-200 {
	background-color: var(--border) !important;
}

/* Text Colors - Foreground */
.text-gray-900,
.text-slate-900,
.text-stone-900,
.text-zinc-900 {
	color: var(--foreground) !important;
}
.text-gray-800,
.text-slate-800,
.text-stone-800,
.text-zinc-800 {
	color: var(--foreground) !important;
}
.text-gray-700,
.text-slate-700,
.text-stone-700,
.text-zinc-700 {
	color: var(--card-foreground) !important;
}

/* Text Colors - Muted */
.text-gray-600,
.text-slate-600,
.text-stone-600,
.text-zinc-600 {
	color: var(--muted-foreground) !important;
}
.text-gray-500,
.text-slate-500,
.text-stone-500,
.text-zinc-500 {
	color: var(--muted-foreground) !important;
}
.text-gray-400,
.text-slate-400,
.text-stone-400,
.text-zinc-400 {
	color: var(--muted-foreground) !important;
}

/* Border Colors */
.border-gray-200,
.border-slate-200,
.border-stone-200,
.border-zinc-200 {
	border-color: var(--border) !important;
}
.border-gray-300,
.border-slate-300,
.border-stone-300,
.border-zinc-300 {
	border-color: var(--border) !important;
}

/* Divide Colors */
.divide-gray-200,
.divide-slate-200,
.divide-stone-200,
.divide-zinc-200 {
	border-color: var(--border) !important;
}

/* Ring Colors */
.ring-gray-200,
.ring-slate-200,
.ring-stone-200,
.ring-zinc-200 {
	--tw-ring-color: var(--border) !important;
}

/* Opacity Variants */
.bg-black\/5 {
	background-color: color-mix(in srgb, var(--foreground) 5%, transparent) !important;
}
.bg-black\/10 {
	background-color: color-mix(in srgb, var(--foreground) 10%, transparent) !important;
}
.bg-white\/5 {
	background-color: color-mix(in srgb, var(--background) 5%, transparent) !important;
}
.bg-white\/10 {
	background-color: color-mix(in srgb, var(--background) 10%, transparent) !important;
}

/* Hover States */
.hover\:bg-black\/5:hover {
	background-color: color-mix(in srgb, var(--foreground) 5%, transparent) !important;
}
.hover\:bg-black\/10:hover {
	background-color: color-mix(in srgb, var(--foreground) 10%, transparent) !important;
}

/* Special fallback for header background */
.header-bg-fallback {
	background: linear-gradient(to bottom, color-mix(in srgb, var(--primary) 10%, var(--muted)), var(--background));
}

/* Leaflet Map Fixes for Dark Mode AND D&D Mode */
.leaflet-container {
	/* background-color: var(--background) !important; */
	font-family: var(--font-sans) !important;
}

/* Ensure popups use theme colors */
.leaflet-popup-content-wrapper {
	background-color: var(--card) !important;
	color: var(--card-foreground) !important;
	border-radius: 0.5rem !important; /* rounded-lg */
	box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1) !important; /* shadow-lg */
}

.leaflet-popup-tip {
	background-color: var(--card) !important;
}

/* Custom Clean Popup - Removes padding so our internal card fits perfectly */
.custom-popup-clean .leaflet-popup-content {
	margin: 0 !important;
	width: 260px !important;
	line-height: 1.5 !important;
}

.custom-popup-clean .leaflet-popup-content-wrapper {
	padding: 0 !important;
	overflow: hidden;
}

/* Marker Popup Cards */
.marker-popup-card {
	@apply bg-card border-0; /* Remove border since wrapper has shadow */
}

.marker-popup-header {
	@apply bg-muted px-3 py-2 border-b border-border;
}

.marker-popup-category {
	@apply text-xs font-bold uppercase tracking-wider text-muted-foreground;
}

.marker-popup-title {
	@apply font-serif font-bold text-foreground text-sm;
}

.marker-popup-body {
	@apply p-3 text-sm text-muted-foreground;
}

/* FIX: Status Badge Semantic Colors */
.badge-alive {
	@apply border-emerald-600/50 bg-emerald-500/20 text-emerald-700;
}
.badge-dead {
	@apply border-red-600/50 bg-red-500/20 text-red-700;
}

/* Dark Mode Overrides */
[data-theme='dark'] .badge-alive {
	@apply text-emerald-400;
}
[data-theme='dark'] .badge-dead {
	@apply text-red-400;
}

/* Custom Clean Popup - Zero padding for custom cards */
.custom-popup-clean .leaflet-popup-content-wrapper {
	padding: 0 !important;
	overflow: hidden !important;
	background: transparent !important; /* Let the card handle bg */
	border: none !important;
	box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1) !important;
}

.custom-popup-clean .leaflet-popup-content {
	margin: 0 !important;
	width: 300px !important; /* Fixed width for consistency */
	line-height: 1.5 !important;
}

/* Ensure the tip matches the theme card color */
.custom-popup-clean .leaflet-popup-tip {
	background-color: var(--card) !important;
}
