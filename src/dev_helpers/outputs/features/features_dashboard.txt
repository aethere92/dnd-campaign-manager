================================================================
PARTIAL BUNDLE: FEATURES DASHBOARD
================================================================

### PROJECT MAP (FILE STRUCTURE)
./
  main.jsx
  app/
    App.jsx
    AppRoutes.jsx
    components/
      RouteLoading.jsx
    styles/
      global.css
  domain/
    entity/
      api/
        entityService.js
      components/
        EntityBadge.jsx
        EntityIcon.jsx
        EntityLink.jsx
        EntityStatusIcon.jsx
      config/
        entityColors.js
        entityConfig.js
        entityIcons.js
        entityStyles.js
        entityTypes.js
      utils/
        attributeParser.js
        entityUtils.js
        statusUtils.js
  features/
    admin/
      api/
        adminService.js
      components/
        AdminForm.jsx
        AdminFormStyles.js
        EncounterManager.jsx
        EntitySearch.jsx
        EventTagger.jsx
        ImageLibraryModal.jsx
        MarkdownEditor.jsx
        QuestObjectiveManager.jsx
        RelationshipManager.jsx
        SessionEventManager.jsx
        SmartImageInput.jsx
        TacticalMapManager.jsx
      config/
        adminStrategies.js
        imageLibrary.js
        imageManifest.json
      layouts/
        AdminLayout.jsx
      pages/
        BulkReplaceTool.jsx
        EntityEditorPage.jsx
        EntityListPage.jsx
        SplitPaneManager.jsx
    atlas/
      MapPage.jsx
      useMapData.js
      components/
        AtlasSidebar.jsx
        MapCanvas.jsx
        MapTools.jsx
        useMapCanvasViewModel.js
        __MapLayerControl.jsx
        layers/
          MapAreas.jsx
          MapMarkers.jsx
          MapOverlays.jsx
          MapRecaps.jsx
      config/
        mapConfig.js
      data/
      utils/
        mapNavigation.js
        markerUtils.js
    campaign/
      CampaignContext.jsx
      useCampaignPersistence.js
      useCampaignSelection.js
      api/
        campaignService.js
      components/
        CampaignCard.jsx
        CampaignSelect.jsx
    dashboard/
      DashboardPage.jsx
      api/
        dashboardService.js
      components/
        ActiveQuestsWidget.jsx
        CampaignHero.jsx
        LatestSessionCard.jsx
        NpcsOfTheMoment.jsx
        QuickInsights.jsx
        RecentEncountersWidget.jsx
        RecentSessionsList.jsx
        SessionRecapCard.jsx
    graph/
      GraphPage.jsx
      useGraphView.js
      api/
        graphService.js
      components/
        CytoscapeCanvas.jsx
        GraphLegend.jsx
      config/
        graphStyles.js
      utils/
        graphMapper.js
    navigation/
      MainLayout.jsx
      useNavigation.js
      components/
        Sidebar.jsx
        SidebarFooter.jsx
        SidebarHeader.jsx
        SidebarNav.jsx
      config/
        navConfig.js
    search/
      GlobalSearch.jsx
      SearchContext.jsx
      useGlobalSearch.js
      api/
        searchService.js
      components/
        SearchFooter.jsx
        SearchModal.jsx
        SearchResultItem.jsx
        SearchResults.jsx
        SearchTrigger.jsx
      utils/
        searchMapper.js
    smart-text/
      SmartMarkdown.jsx
      useEntityIndex.js
      useSmartText.js
      components/
        EntityEmbed.jsx
        SmartEntityLink.jsx
    smart-tooltip/
      TooltipContainer.jsx
      TooltipContext.jsx
      useSmartPosition.js
      useTooltipState.js
      components/
        TooltipCard.jsx
    table-of-contents/
      TableOfContents.jsx
      components/
        TocItem.jsx
        TocMobileDrawer.jsx
      hooks/
        useTocObserver.js
        useTocScroll.js
    timeline/
      TimelinePage.jsx
      useTimelineView.js
      api/
        timelineService.js
      components/
        TimelineEvent.jsx
        TimelineSession.jsx
      utils/
        eventStyles.js
    wiki/
      useEntityView.js
      useWikiNavigation.js
      WikiLayout.jsx
      api/
        wikiService.js
      components/
        EncounterTimeline.jsx
        EntityBody.jsx
        EntityHeader.jsx
        EntityHistory.jsx
        EntityMiniMap.jsx
        EntitySidebar.jsx
        QuestObjectives.jsx
        SessionMentions.jsx
        WikiEntryView.jsx
        landing/
          EntityGridCard.jsx
          EntityPosterCard.jsx
          EntityTableGroup.jsx
          Swimlane.jsx
        navigation/
          SidebarEmptyState.jsx
          WikiSidebar.jsx
          WikiSidebarHeader.jsx
          WikiSidebarList.jsx
          sidebar/
            CollapsibleGroup.jsx
            EntityListItem.jsx
            PriorityIcon.jsx
            SidebarTreeItem.jsx
            StatusIcon.jsx
      config/
        groupingConfig.js
        viewStrategies.js
      hooks/
        useEntityContent.js
        useEntityFetching.js
        useEntityGrouping.js
        useEntityHeader.js
        useEntitySidebar.js
      layouts/
        SessionLayout.jsx
        StandardLayout.jsx
      pages/
        WikiDetailPage.jsx
        WikiLandingPage.jsx
      utils/
        attributeMapper.js
        eventMapper.js
        relationshipMapper.js
        wikiEntryMapper.js
        wikiUtils.js
  shared/
    api/
      supabaseClient.js
    components/
      ErrorBoundary.jsx
      layout/
        CollapsibleSection.jsx
        SplitView.jsx
        TabContainer.jsx
      markdown/
        MarkdownRenderer.jsx
        MarkdownWithToC.jsx
      ui/
        Breadcrumbs.jsx
        Button.jsx
        Card.jsx
        DevAdminButton.jsx
        Drawer.jsx
        EmptyState.jsx
        LoadingSpinner.jsx
        SectionDivider.jsx
    hooks/
      useBreadcrumbs.js
      useTheme.js
    utils/
      imageUtils.js
      markdownUtils.js
      textUtils.js
      theme/
        colorUtils.js
        cssUtils.js

================================================================
### SOURCE CODE
================================================================

--- FILE: features\dashboard\DashboardPage.jsx ---
import { useQuery } from '@tanstack/react-query';
import { useCampaign } from '@/features/campaign/CampaignContext';
import { getDashboardData } from '@/features/dashboard/api/dashboardService';
import LoadingSpinner from '@/shared/components/ui/LoadingSpinner';
import { CampaignHero } from './components/CampaignHero';
import { LatestSessionCard } from './components/LatestSessionCard';
import { RecentSessionsList } from './components/RecentSessionsList';
import { QuickInsights } from './components/QuickInsights';
import { ActiveQuestsWidget } from './components/ActiveQuestsWidget';
import { RecentEncountersWidget } from './components/RecentEncountersWidget';

export default function DashboardView() {
	const { campaignId } = useCampaign();

	const { data, isLoading } = useQuery({
		queryKey: ['dashboard', campaignId],
		queryFn: () => getDashboardData(campaignId),
		enabled: !!campaignId,
		staleTime: 1000 * 60 * 5,
	});

	if (isLoading) {
		return (
			<div className='h-full flex items-center justify-center bg-background'>
				<LoadingSpinner text='Loading campaign overview...' size='lg' />
			</div>
		);
	}

	const { campaign, sessions, stats, activeQuests, recentEncounters } = data || {};
	const latestSession = sessions?.[0];
	const olderSessions = sessions?.slice(1, 4) || [];

	return (
		<div className='h-full overflow-y-auto bg-background custom-scrollbar'>
			{/* Hero Section */}
			<CampaignHero campaign={campaign} stats={stats} />

			{/* Main Content Grid */}
			<div className='max-w-[1600px] mx-auto px-4 sm:px-6 pb-12'>
				{/* Latest Session - Full Width Feature */}
				{latestSession && (
					<div className='mb-8 -mt-10 relative z-10'>
						<LatestSessionCard session={latestSession} />
					</div>
				)}

				{/* Two Column Layout */}
				<div className='grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8'>
					{/* Left Column - Recent Sessions & Insights */}
					<div className='lg:col-span-2 space-y-6'>
						{/* Quick Insights */}
						<QuickInsights stats={stats} sessions={sessions} />

						{/* Recent Sessions */}
						{olderSessions.length > 0 && <RecentSessionsList sessions={olderSessions} />}
					</div>

					{/* Right Column - Widgets */}
					<div className='space-y-6'>
						{/* Active Quests */}
						{activeQuests && activeQuests.length > 0 && <ActiveQuestsWidget quests={activeQuests} />}

						{/* Recent Encounters */}
						{recentEncounters && recentEncounters.length > 0 && (
							<RecentEncountersWidget encounters={recentEncounters} />
						)}
					</div>
				</div>
			</div>
		</div>
	);
}

--- END OF features\dashboard\DashboardPage.jsx ---

--- FILE: features\dashboard\api\dashboardService.js ---
import { supabase } from '@/shared/api/supabaseClient';
import { getAttributeValue, parseAttributes } from '@/domain/entity/utils/attributeParser';

/**
 * Fetch comprehensive dashboard data
 */
export const getDashboardData = async (campaignId) => {
	// 1. Fetch Campaign Info
	const { data: campaign } = await supabase.from('campaigns').select('*').eq('id', campaignId).single();

	// 2. Fetch Sessions with Events (Get ALL sessions, we'll sort by session_number later)
	const { data: sessions, error: sessionError } = await supabase
		.from('sessions')
		.select(
			`
            id, 
            title, 
            narrative,
            created_at,
            events:session_events (
                id, 
                title, 
                description, 
                event_type, 
                event_order
            )
        `
		)
		.eq('campaign_id', campaignId);

	if (sessionError) throw sessionError;
	if (!sessions || sessions.length === 0) {
		return { campaign, sessions: [], stats: {}, activeQuests: [], recentEncounters: [] };
	}

	// 3. Fetch Attributes for Sessions
	const sessionIds = sessions.map((s) => s.id);
	const { data: attributes } = await supabase
		.from('attributes')
		.select('entity_id, name, value')
		.in('entity_id', sessionIds);

	const attrMap = new Map();
	(attributes || []).forEach((attr) => {
		if (!attrMap.has(attr.entity_id)) attrMap.set(attr.entity_id, []);
		attrMap.get(attr.entity_id).push(attr);
	});

	// 4. Process Sessions with Attributes
	const processedSessions = sessions.map((s) => {
		const rawAttrs = attrMap.get(s.id) || [];
		const attrs = rawAttrs.reduce((acc, c) => {
			acc[c.name] = c.value;
			return acc;
		}, {});

		const num = getAttributeValue(attrs, ['session_number', 'Session']) || 999;
		const date = getAttributeValue(attrs, ['session_date', 'Date']) || '';
		const summary = getAttributeValue(attrs, 'Summary');

		return {
			...s,
			name: s.title,
			session_number: Number(num),
			session_date: date,
			description: summary || s.narrative?.substring(0, 200) || '',
			attributes: attrs,
			events: (s.events || []).sort((a, b) => (a.event_order || 0) - (b.event_order || 0)),
		};
	});

	// Sort by session_number DESC to get proper latest session
	processedSessions.sort((a, b) => b.session_number - a.session_number);

	// Take only the 10 most recent for display
	const recentSessions = processedSessions.slice(0, 10);

	// 5. Fetch Event Relationships (for tags/mentions)
	const allEvents = recentSessions.flatMap((s) => s.events);
	const eventIds = allEvents.map((e) => e.id);

	if (eventIds.length > 0) {
		const { data: relationships } = await supabase
			.from('entity_relationships')
			.select(`from_entity_id, target:entities!to_entity_id ( id, name, type )`)
			.in('from_entity_id', eventIds);

		const relMap = new Map();
		(relationships || []).forEach((rel) => {
			if (!relMap.has(rel.from_entity_id)) relMap.set(rel.from_entity_id, []);
			relMap.get(rel.from_entity_id).push(rel);
		});

		recentSessions.forEach((session) => {
			session.events.forEach((event) => {
				event.relationships = relMap.get(event.id) || [];
			});
		});
	}

	// 6. Fetch Direct Session Relationships (only for recent sessions)
	const recentSessionIds = recentSessions.map((s) => s.id);
	const { data: sessionRels } = await supabase
		.from('entity_relationships')
		.select(`from_entity_id, target:entities!to_entity_id ( id, name, type )`)
		.in('from_entity_id', recentSessionIds);

	const sessionRelMap = new Map();
	(sessionRels || []).forEach((rel) => {
		if (!sessionRelMap.has(rel.from_entity_id)) sessionRelMap.set(rel.from_entity_id, []);
		sessionRelMap.get(rel.from_entity_id).push(rel.target);
	});

	// 7. Extract Mentions by Type
	recentSessions.forEach((session) => {
		const mentionsMap = new Map();

		// Add direct session relationships
		const directRels = sessionRelMap.get(session.id) || [];
		directRels.forEach((target) => {
			if (!target) return;
			mentionsMap.set(target.id, {
				id: target.id,
				name: target.name,
				type: target.type,
			});
		});

		// Add event relationships
		session.events.forEach((evt) => {
			if (evt.relationships) {
				evt.relationships.forEach((rel) => {
					if (!rel.target) return;
					mentionsMap.set(rel.target.id, {
						id: rel.target.id,
						name: rel.target.name,
						type: rel.target.type,
					});
				});
			}
		});

		// Group by type
		const groups = {};
		mentionsMap.forEach((item) => {
			const type = item.type?.toLowerCase() || 'other';
			if (!groups[type]) groups[type] = [];
			groups[type].push(item);
		});

		// Sort each group alphabetically
		Object.keys(groups).forEach((key) => {
			groups[key].sort((a, b) => a.name.localeCompare(b.name));
		});

		session.mentions = groups;
	});

	// 8. **FIX: Fetch ALL quests with their attributes properly**
	const { data: allQuestsRaw } = await supabase
		.from('entities')
		.select('id, name')
		.eq('campaign_id', campaignId)
		.eq('type', 'quest')
		.order('name');

	// Fetch attributes for all quests
	let questAttributes = [];
	if (allQuestsRaw && allQuestsRaw.length > 0) {
		const questIds = allQuestsRaw.map((q) => q.id);
		const { data: attrs } = await supabase
			.from('attributes')
			.select('entity_id, name, value')
			.in('entity_id', questIds);
		questAttributes = attrs || [];
	}

	// Map attributes to quests
	const questAttrMap = new Map();
	questAttributes.forEach((attr) => {
		if (!questAttrMap.has(attr.entity_id)) questAttrMap.set(attr.entity_id, []);
		questAttrMap.get(attr.entity_id).push(attr);
	});

	// Process quests with parsed attributes
	const allQuests = (allQuestsRaw || []).map((q) => {
		const rawAttrs = questAttrMap.get(q.id) || [];
		const attrs = parseAttributes(rawAttrs); // Convert array to object
		return {
			...q,
			attributes: attrs,
			rawAttributes: rawAttrs, // Keep raw for potential debugging
		};
	});

	// Fetch objectives for active quests (for display widget)
	const activeQuests = allQuests.filter((q) => {
		const status = getAttributeValue(q.attributes, ['status', 'Status', 'quest status', 'Quest Status']) || '';
		const statusLower = status.toLowerCase();
		return (
			statusLower.includes('active') ||
			statusLower.includes('in progress') ||
			statusLower.includes('progress') ||
			statusLower === '' ||
			statusLower === 'pending'
		);
	});

	// Fetch objectives for the active quests we'll display
	const displayQuestIds = activeQuests.slice(0, 5).map((q) => q.id);
	let questObjectives = [];
	if (displayQuestIds.length > 0) {
		const { data: objectives } = await supabase
			.from('quest_objectives')
			.select('*')
			.in('quest_id', displayQuestIds)
			.order('order_index', { ascending: true });
		questObjectives = objectives || [];
	}

	// Attach objectives to quests
	const displayedActiveQuests = activeQuests.slice(0, 5).map((q) => ({
		...q,
		objectives: questObjectives.filter((obj) => obj.quest_id === q.id),
	}));

	// **FIX: Count completed quests with proper attribute parsing**
	const completedQuestsCount = allQuests.filter((q) => {
		const status = getAttributeValue(q.attributes, ['status', 'Status', 'quest status', 'Quest Status']) || '';
		const statusLower = status.toLowerCase();
		return (
			statusLower.includes('complete') ||
			statusLower.includes('finish') ||
			statusLower.includes('done') ||
			statusLower.includes('success')
		);
	}).length;

	// 9. Fetch Recent Encounters with Session Info
	const { data: recentEncounters } = await supabase
		.from('entities')
		.select('id, name, created_at')
		.eq('campaign_id', campaignId)
		.eq('type', 'encounter')
		.order('created_at', { ascending: false });
	// .limit(5);

	// Attach session info to encounters via relationships
	if (recentEncounters && recentEncounters.length > 0) {
		const encounterIds = recentEncounters.map((e) => e.id);

		const { data: encounterRels } = await supabase
			.from('entity_relationships')
			.select(`from_entity_id, target:entities!to_entity_id ( id, name, type )`)
			.in('from_entity_id', encounterIds)
			.eq('entities.type', 'session');

		const encounterSessionMap = new Map();
		(encounterRels || []).forEach((rel) => {
			if (rel.target && rel.target.type === 'session') {
				encounterSessionMap.set(rel.from_entity_id, rel.target);
			}
		});

		// Fetch session numbers for those sessions
		const encounterSessionIds = Array.from(encounterSessionMap.values()).map((s) => s.id);
		if (encounterSessionIds.length > 0) {
			const { data: sessionAttrs } = await supabase
				.from('attributes')
				.select('entity_id, value')
				.in('entity_id', encounterSessionIds)
				.or('name.eq.session_number,name.eq.Session');

			const sessionNumMap = new Map();
			(sessionAttrs || []).forEach((a) => sessionNumMap.set(a.entity_id, a.value));

			encounterSessionMap.forEach((session) => {
				session.session_number = sessionNumMap.get(session.id);
			});
		}

		// Attach to encounters
		recentEncounters.forEach((enc) => {
			enc.session = encounterSessionMap.get(enc.id) || null;
		});
	}

	// 10. Calculate Stats
	const stats = {
		totalSessions: processedSessions.length,
		totalEncounters: recentEncounters?.length || 0,
		uniqueNPCs: 0,
		uniqueLocations: 0,
		completedQuests: completedQuestsCount,
		activeQuests: activeQuests.length,
		mostActiveSession: null,
		topLocation: null,
		topNPC: null,
	};

	// Count unique entities across recent sessions
	const npcSet = new Set();
	const locationSet = new Set();
	let maxEvents = 0;
	let mostActiveSession = null;

	recentSessions.forEach((session) => {
		// Track most active session
		if (session.events.length > maxEvents) {
			maxEvents = session.events.length;
			mostActiveSession = {
				id: session.id,
				title: session.title,
				eventCount: session.events.length,
			};
		}

		// Count unique entities
		if (session.mentions) {
			(session.mentions.npc || []).forEach((npc) => npcSet.add(npc.id));
			(session.mentions.location || []).forEach((loc) => locationSet.add(loc.id));
		}
	});

	stats.uniqueNPCs = npcSet.size;
	stats.uniqueLocations = locationSet.size;
	stats.mostActiveSession = mostActiveSession;

	// Find most mentioned NPC/Location
	const npcMentions = new Map();
	const locationMentions = new Map();

	recentSessions.forEach((session) => {
		if (session.mentions) {
			(session.mentions.npc || []).forEach((npc) => {
				npcMentions.set(npc.id, {
					name: npc.name,
					count: (npcMentions.get(npc.id)?.count || 0) + 1,
				});
			});
			(session.mentions.location || []).forEach((loc) => {
				locationMentions.set(loc.id, {
					name: loc.name,
					count: (locationMentions.get(loc.id)?.count || 0) + 1,
				});
			});
		}
	});

	// Get top NPC
	let topNPC = { name: 'None', mentions: 0 };
	npcMentions.forEach((data) => {
		if (data.count > topNPC.mentions) {
			topNPC = { name: data.name, mentions: data.count };
		}
	});
	stats.topNPC = topNPC;

	// Get top Location
	let topLocation = { name: 'None', visits: 0 };
	locationMentions.forEach((data) => {
		if (data.count > topLocation.visits) {
			topLocation = { name: data.name, visits: data.count };
		}
	});
	stats.topLocation = topLocation;

	// 11. Return Complete Dashboard Data
	return {
		campaign,
		sessions: recentSessions,
		stats,
		activeQuests: displayedActiveQuests,
		recentEncounters: recentEncounters.slice(0, 5) || [],
	};
};

--- END OF features\dashboard\api\dashboardService.js ---

--- FILE: features\dashboard\components\ActiveQuestsWidget.jsx ---
import { Link } from 'react-router-dom';
import { Scroll, CheckCircle2, Circle } from 'lucide-react';
import { clsx } from 'clsx';

export const ActiveQuestsWidget = ({ quests }) => {
	return (
		<div className='bg-background border border-border rounded-lg shadow-sm overflow-hidden'>
			<div className='px-4 py-3 bg-muted border-b border-border flex items-center justify-between'>
				<h3 className='text-sm font-bold uppercase tracking-wider text-foreground flex items-center gap-2'>
					<Scroll size={14} className='text-blue-600' />
					Active Quests
				</h3>
				<span className='text-xs font-bold text-muted-foreground bg-background px-2 py-0.5 rounded-full border border-border'>
					{quests.length}
				</span>
			</div>
			<div className='divide-y divide-border'>
				{quests.map((quest) => {
					const progress = quest.objectives
						? {
								completed: quest.objectives.filter((o) => o.status === 'completed').length,
								total: quest.objectives.length,
						  }
						: null;

					return (
						<Link
							key={quest.id}
							to={`/wiki/quest/${quest.id}`}
							className='block px-4 py-3 hover:bg-muted/50 transition-colors group'>
							<div className='flex items-start gap-3'>
								<Circle size={16} className='text-blue-500 shrink-0 mt-0.5' strokeWidth={2.5} />
								<div className='flex-1 min-w-0'>
									<p className='text-sm font-semibold text-foreground group-hover:text-primary transition-colors mb-1'>
										{quest.name}
									</p>
									{progress && (
										<div className='flex items-center gap-2'>
											<div className='flex-1 h-1.5 bg-muted rounded-full overflow-hidden border border-border'>
												<div
													className='h-full bg-blue-500/100 transition-all'
													style={{ width: `${(progress.completed / progress.total) * 100}%` }}
												/>
											</div>
											<span className='text-xs font-medium text-muted-foreground whitespace-nowrap'>
												{progress.completed}/{progress.total}
											</span>
										</div>
									)}
								</div>
							</div>
						</Link>
					);
				})}
			</div>
		</div>
	);
};

--- END OF features\dashboard\components\ActiveQuestsWidget.jsx ---

--- FILE: features\dashboard\components\CampaignHero.jsx ---
import { Sparkles, Calendar, MapPin, Users, Swords } from 'lucide-react';
import { clsx } from 'clsx';

export const CampaignHero = ({ campaign, stats }) => {
	const logoPath = `${import.meta.env.BASE_URL}logo_detailed.png`;

	return (
		<div className='relative overflow-hidden border-b border-border bg-background'>
			{/* Gradient Backdrop - Subtler in dark mode */}
			<div className='absolute inset-0 bg-gradient-to-br from-amber-500/10 via-background to-background' />

			{/* Background Pattern */}
			<div
				className='absolute inset-0 opacity-[0.05]'
				style={{
					backgroundImage: `radial-gradient(circle at 1px 1px, currentColor 1px, transparent 0)`,
					backgroundSize: '40px 40px',
				}}
			/>

			<div className='relative max-w-[1600px] mx-auto px-4 sm:px-6 py-12 md:py-16'>
				<div className='flex flex-col md:flex-row md:items-center gap-8'>
					{/* Logo */}
					<div className='shrink-0'>
						<img src={logoPath} alt='Campaign Logo' className='h-32 md:h-40 drop-shadow-2xl opacity-100' />
					</div>

					{/* Campaign Info */}
					<div className='flex-1'>
						<div className='flex items-center gap-3 mb-3'>
							<Sparkles size={20} className='text-primary' />
							<span className='text-xs font-bold uppercase tracking-widest text-primary'>Campaign Chronicle</span>
						</div>
						<h1 className='text-4xl md:text-5xl font-serif font-bold text-foreground mb-4 leading-tight'>
							{campaign?.name || 'Your Campaign'}
						</h1>
						{campaign?.description && (
							<p className='text-sm md:text-base text-muted-foreground leading-relaxed max-w-2xl'>
								{campaign.description}
							</p>
						)}
					</div>

					{/* Stats Grid */}
					<div className='grid grid-cols-2 md:grid-cols-4 lg:grid-cols-2 gap-4 md:gap-6'>
						<StatBadge icon={Calendar} label='Sessions' value={stats?.totalSessions || 0} />
						<StatBadge icon={Swords} label='Encounters' value={stats?.totalEncounters || 0} />
						<StatBadge icon={Users} label='NPCs Met' value={stats?.uniqueNPCs || 0} />
						<StatBadge icon={MapPin} label='Locations' value={stats?.uniqueLocations || 0} />
					</div>
				</div>
			</div>
		</div>
	);
};

const StatBadge = ({ icon: Icon, label, value }) => (
	<div className='bg-card/50 backdrop-blur-sm border border-border rounded-lg p-4 shadow-sm hover:border-accent/50 transition-colors'>
		<div className='flex items-center gap-2 text-muted-foreground mb-1'>
			<Icon size={14} strokeWidth={2.5} />
			<span className='text-[10px] font-bold uppercase tracking-wider'>{label}</span>
		</div>
		<p className='text-3xl font-serif font-bold text-foreground'>{value}</p>
	</div>
);

--- END OF features\dashboard\components\CampaignHero.jsx ---

--- FILE: features\dashboard\components\LatestSessionCard.jsx ---
import { Link } from 'react-router-dom';
import { Calendar, ArrowRight, Sparkles, MapPin, Users, Scroll, Swords } from 'lucide-react';
import { clsx } from 'clsx';
import { getEntityConfig } from '@/domain/entity/config/entityConfig';
import { SectionDivider } from '@/shared/components/ui/SectionDivider';

export const LatestSessionCard = ({ session }) => {
	const keyEvents = session.events
		?.filter((e) => {
			const isImportant = [
				'combat',
				'quest_started',
				'quest_progressed',
				'npc_encountered',
				'location_discovered',
			].includes(e.event_type?.toLowerCase());
			return isImportant || (e.relationships && e.relationships.length > 2);
		})
		.slice(0, 5);

	const mentionsByType = session.mentions
		? Object.entries(session.mentions)
				.map(([type, items]) => ({ type, items: items.slice(0, 5), total: items.length }))
				.filter((g) => g.total > 0)
		: [];

	return (
		<div className='bg-background border-2 border-primary/20 rounded-2xl shadow-2xl overflow-hidden hover:border-primary/40 transition-all group'>
			{/* Header Banner */}
			<div className='bg-gradient-to-r from-primary/10 via-primary/5 to-transparent px-6 py-4 border-b border-border/50'>
				<div className='flex items-center justify-between'>
					<div className='flex items-center gap-3'>
						<div className='p-2 bg-primary/10 rounded-lg border border-primary/20'>
							<Sparkles size={20} className='text-primary' />
						</div>
						<div>
							<span className='text-xs font-bold uppercase tracking-widest text-primary block mb-0.5'>
								Latest Session
							</span>
							<div className='flex items-center gap-2'>
								<span className='text-[11px] font-bold uppercase tracking-wider text-muted-foreground bg-muted px-2 py-0.5 rounded border border-border'>
									Session {session.session_number - 1}
								</span>
								{session.session_date && (
									<span className='text-xs text-muted-foreground flex items-center gap-1'>
										<Calendar size={11} strokeWidth={2.5} />
										{session.session_date}
									</span>
								)}
							</div>
						</div>
					</div>
					<Link
						to={`/wiki/session/${session.id}`}
						className='flex items-center gap-2 px-4 py-2 bg-primary/10 hover:bg-primary/20 text-primary font-semibold text-sm rounded-lg border border-primary/20 transition-all group-hover:translate-x-1'>
						Full Details
						<ArrowRight size={16} />
					</Link>
				</div>
			</div>

			{/* Content */}
			<div className='p-6'>
				{/* Title & Description */}
				<h2 className='text-3xl font-serif font-bold text-foreground mb-3 leading-tight'>{session.name}</h2>
				{session.description && (
					<p className='text-sm text-muted-foreground leading-relaxed mb-6 max-w-3xl'>{session.description}</p>
				)}

				<SectionDivider />

				{/* Two Column Layout */}
				<div className='grid grid-cols-1 lg:grid-cols-2 gap-8 mt-6'>
					{/* Left: Key Events */}
					<div>
						<h3 className='text-sm font-bold uppercase tracking-wider text-muted-foreground mb-4 flex items-center gap-2'>
							<Swords size={14} className='text-primary' />
							Key Moments
						</h3>
						{keyEvents && keyEvents.length > 0 ? (
							<div className='space-y-3'>
								{keyEvents.map((event) => (
									<div key={event.id} className='flex items-start gap-3 group/item'>
										<div className='shrink-0 w-2 h-2 rounded-full bg-primary/40 mt-2 group-hover/item:bg-primary transition-colors' />
										<div className='flex-1 min-w-0'>
											<p className='text-sm font-semibold text-foreground leading-snug mb-0.5'>{event.title}</p>
											{event.description && (
												<p className='text-xs text-muted-foreground line-clamp-2 leading-relaxed'>
													{event.description}
												</p>
											)}
										</div>
									</div>
								))}
							</div>
						) : (
							<p className='text-xs text-muted-foreground italic'>No events recorded</p>
						)}
					</div>

					{/* Right: Entity Mentions */}
					<div>
						<h3 className='text-sm font-bold uppercase tracking-wider text-muted-foreground mb-4 flex items-center gap-2'>
							<Users size={14} className='text-primary' />
							Entities Encountered
						</h3>
						<div className='space-y-4'>
							{mentionsByType.map(({ type, items, total }) => {
								const config = getEntityConfig(type);
								const Icon = config.icon;

								return (
									<div key={type}>
										<div className='flex items-center gap-2 mb-2'>
											<Icon size={12} className={clsx(config.tailwind.text, 'opacity-70')} strokeWidth={2.5} />
											<span className='text-xs font-bold text-muted-foreground uppercase tracking-wider'>
												{config.labelPlural}
											</span>
											<span className='text-[10px] font-bold text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full border border-border'>
												{total}
											</span>
										</div>
										<div className='flex flex-wrap gap-1.5 ml-5'>
											{items.map((entity, idx) => (
												<Link
													key={`${entity.id}-${idx}`}
													to={`/wiki/${type}/${entity.id}`}
													className={clsx(
														'text-xs font-semibold px-2 py-1 rounded border transition-all hover:shadow-sm',
														config.tailwind.bg,
														config.tailwind.text,
														config.tailwind.border,
														'hover:scale-105'
													)}>
													{entity.name}
												</Link>
											))}
											{total > 5 && <span className='text-xs text-muted-foreground px-2 py-1'>+{total - 5} more</span>}
										</div>
									</div>
								);
							})}
						</div>
					</div>
				</div>
			</div>
		</div>
	);
};

--- END OF features\dashboard\components\LatestSessionCard.jsx ---

--- FILE: features\dashboard\components\NpcsOfTheMoment.jsx ---
import { Link } from 'react-router-dom';
import { Users } from 'lucide-react';
import { getEntityConfig } from '@/domain/entity/config/entityConfig';

export const NpcsOfTheMoment = ({ npcs }) => {
	if (!npcs?.length) return null;
	const config = getEntityConfig('npc');

	return (
		<div className='bg-background border border-border rounded-lg shadow-sm overflow-hidden'>
			<div className='px-4 py-3 bg-muted border-b border-border flex items-center justify-between'>
				<h3 className='text-sm font-bold uppercase tracking-wider text-foreground flex items-center gap-2'>
					<Users size={14} className='text-primary' />
					NPCs of the Moment
				</h3>
			</div>
			<div className='p-4 flex flex-wrap gap-3'>
				{npcs.map((npc) => (
					<Link key={npc.id} to={`/wiki/npc/${npc.id}`} className={`flex flex-col items-center gap-2 group w-20`}>
						<div
							className={`w-12 h-12 rounded-full flex items-center justify-center border-2 transition-transform group-hover:scale-110 ${config.tailwind.bg} ${config.tailwind.border}`}>
							<span className='text-lg font-bold'>{npc.name[0]}</span>
						</div>
						<span className='text-[10px] font-bold text-center text-foreground group-hover:text-primary transition-colors line-clamp-2'>
							{npc.name}
						</span>
					</Link>
				))}
			</div>
		</div>
	);
};

--- END OF features\dashboard\components\NpcsOfTheMoment.jsx ---

--- FILE: features\dashboard\components\QuickInsights.jsx ---
import { TrendingUp, Trophy, Map, Users } from 'lucide-react';
import { clsx } from 'clsx';

export const QuickInsights = ({ stats, sessions }) => {
	const insights = [
		{
			icon: TrendingUp,
			label: 'Most Active Session',
			value: stats?.mostActiveSession?.title || 'N/A',
			subtitle: `${stats?.mostActiveSession?.eventCount || 0} events`,
			color: 'text-blue-600',
			bg: 'bg-blue-500/10',
			border: 'border-blue-500/30',
		},
		{
			icon: Map,
			label: 'Most Visited Location',
			value: stats?.topLocation?.name || 'N/A',
			subtitle: `${stats?.topLocation?.visits || 0} visits`,
			color: 'text-emerald-600',
			bg: 'bg-emerald-500/10',
			border: 'border-emerald-500/30',
		},
		{
			icon: Users,
			label: 'Most Encountered NPC',
			value: stats?.topNPC?.name || 'N/A',
			subtitle: `${stats?.topNPC?.mentions || 0} mentions`,
			color: 'text-amber-600',
			bg: 'bg-amber-500/10',
			border: 'border-amber-500/30',
		},
		{
			icon: Trophy,
			label: 'Quests Completed',
			value: stats?.completedQuests || 0,
			subtitle: `${stats?.activeQuests || 0} still active`,
			color: 'text-purple-600',
			bg: 'bg-purple-500/10',
			border: 'border-purple-500/30',
		},
	];

	return (
		<div>
			<h2 className='text-xl font-serif font-bold text-foreground mb-4'>Campaign Insights</h2>
			<div className='grid grid-cols-1 md:grid-cols-2 gap-4'>
				{insights.map((insight, idx) => {
					const Icon = insight.icon;
					return (
						<div
							key={idx}
							className={clsx('bg-background border rounded-lg p-4 hover:shadow-md transition-all', insight.border)}>
							<div className='flex items-start gap-3'>
								<div className={clsx('p-2 rounded-lg shrink-0', insight.bg)}>
									<Icon size={20} className={insight.color} strokeWidth={2.5} />
								</div>
								<div className='flex-1 min-w-0'>
									<p className='text-[10px] font-bold uppercase tracking-wider text-muted-foreground mb-1'>
										{insight.label}
									</p>
									<p className='text-lg font-serif font-bold text-foreground truncate mb-0.5'>{insight.value}</p>
									<p className='text-xs text-muted-foreground'>{insight.subtitle}</p>
								</div>
							</div>
						</div>
					);
				})}
			</div>
		</div>
	);
};

--- END OF features\dashboard\components\QuickInsights.jsx ---

--- FILE: features\dashboard\components\RecentEncountersWidget.jsx ---
import { Link } from 'react-router-dom';
import { Swords, Skull } from 'lucide-react';
import { clsx } from 'clsx';

export const RecentEncountersWidget = ({ encounters }) => {
	return (
		<div className='bg-background border border-border rounded-lg shadow-sm overflow-hidden'>
			<div className='px-4 py-3 bg-muted border-b border-border flex items-center justify-between'>
				<h3 className='text-sm font-bold uppercase tracking-wider text-foreground flex items-center gap-2'>
					<Swords size={14} className='text-red-600' />
					Recent Encounters
				</h3>
				<span className='text-xs font-bold text-muted-foreground bg-background px-2 py-0.5 rounded-full border border-border'>
					{encounters.length}
				</span>
			</div>
			<div className='divide-y divide-border'>
				{encounters.map((encounter) => (
					<Link
						key={encounter.id}
						to={`/wiki/encounter/${encounter.id}`}
						className='block px-4 py-3 hover:bg-muted/50 transition-colors group'>
						<div className='flex items-start gap-3'>
							<Skull size={16} className='text-red-500 shrink-0 mt-0.5' strokeWidth={2.5} />
							<div className='flex-1 min-w-0'>
								<p className='text-sm font-semibold text-foreground group-hover:text-primary transition-colors mb-0.5'>
									{encounter.name}
								</p>
								{encounter.session && (
									<p className='text-xs text-muted-foreground'>Session {encounter.session.session_number - 1}</p>
								)}
							</div>
						</div>
					</Link>
				))}
			</div>
		</div>
	);
};

--- END OF features\dashboard\components\RecentEncountersWidget.jsx ---

--- FILE: features\dashboard\components\RecentSessionsList.jsx ---
import { Link } from 'react-router-dom';
import { Calendar, ArrowRight } from 'lucide-react';
import { clsx } from 'clsx';

export const RecentSessionsList = ({ sessions }) => {
	return (
		<div>
			<h2 className='text-xl font-serif font-bold text-foreground mb-4'>Recent Sessions</h2>
			<div className='space-y-3'>
				{sessions.map((session) => (
					<Link
						key={session.id}
						to={`/wiki/session/${session.id}`}
						className='block bg-background border border-border rounded-lg p-4 hover:border-primary/30 hover:shadow-md transition-all group'>
						<div className='flex items-start justify-between gap-4'>
							<div className='flex-1 min-w-0'>
								<div className='flex items-center gap-2 mb-1'>
									<span className='text-[10px] font-bold uppercase tracking-wider text-muted-foreground bg-muted px-2 py-0.5 rounded border border-border'>
										Session {session.session_number - 1}
									</span>
									{session.session_date && (
										<span className='text-xs text-muted-foreground flex items-center gap-1'>
											<Calendar size={10} />
											{session.session_date}
										</span>
									)}
								</div>
								<h3 className='text-base font-serif font-bold text-foreground mb-1 group-hover:text-primary transition-colors'>
									{session.name}
								</h3>
								{session.description && (
									<p className='text-xs text-muted-foreground line-clamp-2 leading-relaxed'>{session.description}</p>
								)}
								{session.events && session.events.length > 0 && (
									<div className='mt-2 flex items-center gap-2 text-xs text-muted-foreground'>
										<span>{session.events.length} events</span>
										{session.mentions && (
											<>
												<span>•</span>
												<span>
													{Object.values(session.mentions).reduce((sum, arr) => sum + arr.length, 0)} entities
												</span>
											</>
										)}
									</div>
								)}
							</div>
							<ArrowRight
								size={18}
								className='shrink-0 text-muted-foreground/70 group-hover:text-primary group-hover:translate-x-1 transition-all'
							/>
						</div>
					</Link>
				))}
			</div>
		</div>
	);
};

--- END OF features\dashboard\components\RecentSessionsList.jsx ---

--- FILE: features\dashboard\components\SessionRecapCard.jsx ---
import { Link } from 'react-router-dom';
import { Calendar, ArrowRight, Swords, Users, MapPin, Scroll } from 'lucide-react';
import { clsx } from 'clsx';
import EntityIcon from '@/domain/entity/components/EntityIcon';
import { getEntityConfig } from '@/domain/entity/config/entityConfig';

export const SessionRecapCard = ({ session, featured = false }) => {
	// Extract highlights (events with most mentions or specific types)
	const highlights = session.events
		?.filter((e) => {
			const hasMentions = e.relationships?.length > 0;
			const isImportant = ['combat', 'quest_started', 'quest_progressed', 'npc_encountered'].includes(
				e.event_type?.toLowerCase()
			);
			return hasMentions || isImportant;
		})
		.slice(0, 3);

	// Count mentions by type
	const mentionCounts = session.mentions
		? Object.entries(session.mentions).reduce((acc, [type, items]) => {
				if (items.length > 0) {
					acc.push({ type, count: items.length, items: items.slice(0, 3) });
				}
				return acc;
		  }, [])
		: [];

	return (
		<Link
			to={`/wiki/session/${session.id}`}
			className={clsx(
				'block group transition-all',
				featured
					? 'bg-background border-2 border-accent/30 rounded-xl p-6 shadow-lg hover:shadow-xl hover:border-accent/50'
					: 'bg-background border border-border rounded-lg p-4 shadow-sm hover:shadow-md hover:border-accent/30'
			)}>
			{/* Header */}
			<div className='flex items-start justify-between mb-4'>
				<div className='flex-1 min-w-0'>
					<div className='flex items-center gap-2 mb-1'>
						<span
							className={clsx(
								'text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded',
								featured
									? 'bg-accent/10 text-primary border border-accent/30'
									: 'bg-muted text-muted-foreground border border-border'
							)}>
							Session {session.session_number - 1}
						</span>
						{session.session_date && (
							<span className='text-xs text-muted-foreground flex items-center gap-1'>
								<Calendar size={10} />
								{session.session_date}
							</span>
						)}
					</div>
					<h3
						className={clsx(
							'font-serif font-bold group-hover:text-primary transition-colors',
							featured ? 'text-2xl mb-2' : 'text-lg mb-1'
						)}>
						{session.name}
					</h3>
					{session.description && (
						<p className={clsx('text-muted-foreground leading-relaxed', featured ? 'text-sm' : 'text-xs line-clamp-2')}>
							{session.description}
						</p>
					)}
				</div>
				<ArrowRight
					size={featured ? 20 : 16}
					className='shrink-0 text-muted-foreground/70 group-hover:text-primary group-hover:translate-x-1 transition-all'
				/>
			</div>

			{/* Highlights */}
			{highlights && highlights.length > 0 && (
				<div className='mb-4'>
					<h4 className='text-xs font-bold uppercase tracking-wider text-muted-foreground mb-2 flex items-center gap-1'>
						<Swords size={10} /> Key Moments
					</h4>
					<div className='space-y-1.5'>
						{highlights.map((event) => (
							<div key={event.id} className='flex items-start gap-2 text-xs'>
								<span className='text-primary mt-0.5'>•</span>
								<span className='text-foreground leading-snug'>{event.title}</span>
							</div>
						))}
					</div>
				</div>
			)}

			{/* Mentions Summary */}
			{mentionCounts.length > 0 && (
				<div className='flex flex-wrap gap-3 pt-3 border-t border-border/50'>
					{mentionCounts.map(({ type, count, items }) => {
						const config = getEntityConfig(type);
						const Icon = config.icon;

						return (
							<div key={type} className='flex items-center gap-2'>
								<div
									className={clsx(
										'flex items-center gap-1 text-[10px] font-medium px-2 py-1 rounded border',
										config.tailwind.bg,
										config.tailwind.text,
										config.tailwind.border
									)}>
									<Icon size={10} />
									<span className='font-bold'>{count}</span>
									<span className='opacity-70'>{config.labelPlural}</span>
								</div>
							</div>
						);
					})}
				</div>
			)}
		</Link>
	);
};

--- END OF features\dashboard\components\SessionRecapCard.jsx ---

