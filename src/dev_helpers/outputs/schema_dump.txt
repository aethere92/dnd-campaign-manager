=========================================
   SUPABASE FULL DIAGNOSTIC DUMP (V3)
   Generated: 1/2/2026, 11:03:10 AM
=========================================

-----------------------------------------
TABLE: attributes [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  entity_id                 uuid             
  name                      text             
  value                     text             
  is_private                boolean          DEFAULT false
  created_at                timestamp with time zone NOT NULL DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "51816d5f-7fed-4aea-83c9-300cbaddf6c0",
    "entity_id": "fa4737ee-f3b3-3298-3a4f-287442144513",
    "name": "affinity",
    "value": "Enemy",
    "is_private": false,
    "created_at": "2025-12-29T16:55:00.014Z",
    "updated_at": "2025-12-29T16:55:00.014Z"
  },
  {
    "id": "1a61137c-3438-4933-bc0c-8722335fc124",
    "entity_id": "fa4737ee-f3b3-3298-3a4f-287442144513",
    "name": "status",
    "value": "alive",
    "is_private": false,
    "created_at": "2025-12-29T16:55:00.014Z",
    "updated_at": "2025-12-29T16:55:00.014Z"
  }
]

-----------------------------------------
TABLE: campaigns [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  campaign_id               integer         NOT NULL 
  name                      text            NOT NULL 
  metadata                  jsonb            DEFAULT '{}'::jsonb
  created_at                timestamp with time zone  DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  description               text             
  map_data                  text             

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "campaign_id": 2,
    "name": "Red Hand of Doom",
    "metadata": {},
    "created_at": "2025-11-19T18:55:54.343Z",
    "updated_at": "2025-11-19T18:55:54.343Z",
    "description": "Five unlikely heroes journey through lush subtropical forests. Bound by shared purpose or hidden motives, their story begins on a wild path where camaraderie grows with each step.\n",
    "map_data": null
  },
  {
    "id": "d147179e-fe98-47e4-84ea-b3bb2e4bc238",
    "campaign_id": 1,
    "name": "A quest, a questin' we shall go",
    "metadata": {
      "defaultMap": "korinis_island"
    },
    "created_at": "2025-12-01T12:40:52.720Z",
    "updated_at": "2025-12-01T12:40:52.720Z",
    "description": "Six adventurers receive mysterious invitations to a strange, distant land. Teaming up with pirates, they battle monsters and navigate treacherous seas toward the enigmatic island of Korinis.",
    "map_data": "CAMPAIGN_01"
  }
]

-----------------------------------------
TABLE: characters [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  campaign_id               uuid            NOT NULL 
  name                      text            NOT NULL 
  created_at                timestamp with time zone  DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  description               text             
  attributes                jsonb            DEFAULT '{}'::jsonb

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "a87b1f4d-421d-4064-827f-470a6e6d0574",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "Loraine",
    "created_at": "2025-12-07T20:22:47.251Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "description": "Work in progress, will be available later.",
    "attributes": {
      "race": "Vampire",
      "class": "Fighter Battlemaster",
      "level": "8",
      "speed": "30ft.",
      "is_active": "true",
      "hit points": "N/A",
      "armor class": "N/A"
    }
  },
  {
    "id": "fd992811-d20d-4231-9a71-7dadedc7b82c",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "Olek",
    "created_at": "2025-11-21T11:18:32.073Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "description": null,
    "attributes": {
      "icon": "../../images/assets/character_thumbnails/campaign_002/olek.jpeg",
      "race": "Aasimar",
      "class": "Paladin / Warlock",
      "level": "8",
      "speed": "40ft.",
      "is_active": "true",
      "hit points": "59",
      "armor class": "19",
      "saving throw": [
        {
          "value": "STR +6",
          "is_private": false
        },
        {
          "value": "DEX +3",
          "is_private": false
        },
        {
          "value": "CON +6",
          "is_private": false
        },
        {
          "value": "INT +4",
          "is_private": false
        },
        {
          "value": "WIS +8",
          "is_private": false
        },
        {
          "value": "CHA +11",
          "is_private": false
        }
      ],
      "ability score": [
        {
          "value": "STR 14 (+2)",
          "is_private": false
        },
        {
          "value": "DEX 8 (-1)",
          "is_private": false
        },
        {
          "value": "CON 14 (+2)",
          "is_private": false
        },
        {
          "value": "INT 10 (+0)",
          "is_private": false
        },
        {
          "value": "WIS 12 (+1)",
          "is_private": false
        },
        {
          "value": "CHA 18 (+4)",
          "is_private": false
        }
      ],
      "background_image": "images/assets/character_backgrounds/campaign_002/olek_bg.jpg"
    }
  }
]

-----------------------------------------
TABLE: encounter_actions [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  encounter_id              uuid            NOT NULL 
  round_number              integer         NOT NULL 
  action_order              integer         NOT NULL 
  actor_name                text            NOT NULL 
  actor_entity_id           uuid             
  is_friendly               boolean          
  action_type               text             
  action_description        text            NOT NULL 
  target_name               text             
  target_entity_id          uuid             
  result                    text             
  effect                    text             
  created_at                timestamp with time zone  DEFAULT now()

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "a1000000-0001-0000-0000-000000000001",
    "encounter_id": "e0548e36-026a-4566-9c80-c4e7b0e3b217",
    "round_number": 1,
    "action_order": 1,
    "actor_name": "Brotherhood Summoner",
    "actor_entity_id": null,
    "is_friendly": false,
    "action_type": "spell",
    "action_description": "Chanted in a guttural language to open a rift.",
    "target_name": null,
    "target_entity_id": null,
    "result": "SUCCESS",
    "effect": "Summoned 8 lesser demons into the alley.",
    "created_at": "2025-12-25T18:00:00.000Z"
  },
  {
    "id": "4d4d4d4d-0004-4000-a000-000000000003",
    "encounter_id": "77ab3aa0-dcae-46a3-9cc5-ae0e4b8c3773",
    "round_number": 4,
    "action_order": 3,
    "actor_name": "Kaedin",
    "actor_entity_id": "78700f6d-11a7-4ae0-ab50-a1a1b498c1d7",
    "is_friendly": true,
    "action_type": "action",
    "action_description": "Summoned an Echo and shouted a warning.",
    "target_name": "Party",
    "target_entity_id": "22de4109-6224-474a-9104-bc044c5562d2",
    "result": "SUCCESS",
    "effect": "Revealed that the pillars have Repulsion Wards protecting them.",
    "created_at": "2025-12-25T14:48:10.000Z"
  }
]

-----------------------------------------
TABLE: encounters [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  campaign_id               uuid            NOT NULL 
  name                      text            NOT NULL 
  description               text             
  created_at                timestamp with time zone  DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  attributes                jsonb            DEFAULT '{}'::jsonb

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "e0548e36-026a-4566-9c80-c4e7b0e3b217",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "Demonic Ambush",
    "description": "Pursuing thieves into a dark alley, the party fell into a trap set by Brotherhood agents. A hooded summoner conjured lesser demons while archers rained poison arrows from the rooftops. Kaedin and Loraine held the line against the demonic onslaught, utilizing echoes and vampiric blood magic, while Soshi and Bonnie provided devastating fire support and healing. Despite being poisoned and outnumbered, the party broke the summoner's defenses, killing the demons and forcing the surviving agents to flee.",
    "created_at": "2025-12-25T15:17:42.658Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "status": "Completed",
      "map_image": "images/assets/map_backgrounds/demonic_ambush_map.png",
      "background_image": "images/assets/encounter_backgrounds/campaign_002/demonic_ambush_bg.jpg"
    }
  },
  {
    "id": "8e2cb244-6777-4910-af72-5538358efc14",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "Reptile battle",
    "description": null,
    "created_at": "2025-12-26T18:26:12.756Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "status": "Completed"
    }
  }
]

-----------------------------------------
TABLE: entities [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  type                      text            NOT NULL 
  name                      text            NOT NULL 
  created_at                timestamp with time zone  DEFAULT now()
  campaign_id               uuid            NOT NULL 
  description               text             

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "429c2b28-8a8b-46ec-866d-97259d8de00e",
    "type": "npc",
    "name": "Bianca Turiados",
    "created_at": "2025-11-21T06:46:31.612Z",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "description": "Last descendant and true Queen of Pelagos. Fey-touched with lightning-veined eyes.\n"
  },
  {
    "id": "ea565b92-b8c1-4e8f-9a05-41d88225a0ff",
    "type": "npc",
    "name": "Commander Turiados",
    "created_at": "2025-11-19T21:06:38.740Z",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "description": "7-foot-tall warrior covered in Sahuagin shaman tattoos. Formerly Order of Inos."
  }
]

-----------------------------------------
TABLE: entity_relationships [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  from_entity_id            uuid            NOT NULL 
  to_entity_id              uuid            NOT NULL 
  relationship_type         text            NOT NULL 
  description               text             
  created_at                timestamp with time zone  DEFAULT now()
  is_bidirectional          boolean          
  is_hidden                 boolean          DEFAULT false

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "b33bb8e6-04e0-4762-b489-94ef3785d51b",
    "from_entity_id": "7510ae7d-9133-476e-902c-6aea36e82b46",
    "to_entity_id": "957b14a8-c53f-4237-a540-9d5c3474bc5f",
    "relationship_type": "mention",
    "description": null,
    "created_at": "2025-12-25T07:38:28.148Z",
    "is_bidirectional": false,
    "is_hidden": false
  },
  {
    "id": "fa54562e-21ad-4483-a292-797b1dd70a82",
    "from_entity_id": "7510ae7d-9133-476e-902c-6aea36e82b46",
    "to_entity_id": "8427e65e-de6e-4419-b404-73b9704d9543",
    "relationship_type": "mention",
    "description": null,
    "created_at": "2025-12-25T07:38:31.721Z",
    "is_bidirectional": false,
    "is_hidden": false
  }
]

-----------------------------------------
TABLE: factions [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  campaign_id               uuid            NOT NULL 
  name                      text            NOT NULL 
  description               text             
  created_at                timestamp with time zone  DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  attributes                jsonb            DEFAULT '{}'::jsonb

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "e24e62dd-c9d5-4c5d-87b0-18c09392dc09",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "The Harpers",
    "description": "A semi-secret organization dedicated to promoting good and preserving history. They have not yet made a direct appearance in the campaign, but their reputation as a network of spies and informants makes them a potential future ally against the widespread conspiracy of the Red Hand and Arcane Brotherhood.",
    "created_at": "2025-11-21T17:01:11.633Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "affinity": "neutral"
    }
  },
  {
    "id": "fe902f1d-1aeb-4029-97f4-1e247aa902ac",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "Red Wizards of Thay",
    "description": "A notorious magocracy of evil wizards from the distant land of Thay. They have not been encountered directly, but they featured prominently in Soshi's apocalyptic vision. They were seen working alongside the Arcane Brotherhood and the Clan of the Blue Bear to conduct a massive ritual siege against the city of Neverwinter, using prisoners as magical fuel to tear down the walls. Their involvement confirms the global scale of the conspiracy.",
    "created_at": "2025-11-21T17:00:01.009Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "affinity": "enemy"
    }
  }
]

-----------------------------------------
TABLE: items [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  session_id                uuid             
  name                      text             
  description               text             
  created_at                timestamp with time zone NOT NULL DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  attributes                jsonb            DEFAULT '{}'::jsonb

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "322da049-3ada-475c-a89e-1af5a1990d63",
    "session_id": "a76b7458-a291-4385-b6f0-bb7d72e0657b",
    "name": "Rabbit's Foot",
    "description": "Marks your allegiance to the Black Crag Horde and, as a free action once per day, allows you to gain 1d4 temporary hp. ",
    "created_at": "2025-11-30T14:23:26.356Z",
    "updated_at": "2025-11-30T14:23:26.356Z",
    "attributes": {}
  },
  {
    "id": "491f2bd3-1d54-401b-b5f9-65690486728e",
    "session_id": "a76b7458-a291-4385-b6f0-bb7d72e0657b",
    "name": "Giant Javelin",
    "description": "Deals 1d12 damage. When used against giant-sized creatures or larger, they gain +5 to hit and damage, though their range is limited to 20/40 feet and require 14 strength to wield effectively.",
    "created_at": "2025-11-30T14:24:30.716Z",
    "updated_at": "2025-11-30T14:24:30.716Z",
    "attributes": {}
  }
]

-----------------------------------------
TABLE: locations [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  campaign_id               uuid            NOT NULL 
  name                      text            NOT NULL 
  description               text             
  created_at                timestamp with time zone  DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  attributes                jsonb            DEFAULT '{}'::jsonb

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "af13371c-eea3-432b-a188-714861e5591b",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "Elsir Vale",
    "description": "A broad region containing both Drellin's Ferry and Brindol, connected by the Dawn Way road system. The Vale is characterized by orchards, grain fields, farmlands, and the winding Elsir River. Once peaceful, it has become the primary theater of the Red Hand's invasion. The region contains the Witchwood, various smaller settlements, and strategic infrastructure like the destroyed bridge. Lord Aaron Jarmaath rules from Brindol, the largest fortified settlement in the area. The Vale's agricultural wealth and strategic position make it a key target for conquest.",
    "created_at": "2025-11-21T06:39:03.958Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "type": "region",
      "map_image": "images/assets/map_backgrounds/elsir_vale_map.png",
      "map_markers": "[{\"lat\":-699,\"lng\":1091,\"label\":\"Strategic Bridge\",\"category\":\"quest\"},{\"lat\":-879,\"lng\":1068,\"label\":\"Vraath Keep\",\"category\":\"location\"},{\"lat\":-915,\"lng\":1239,\"label\":\"Drellin's Ferry\",\"category\":\"city\"},{\"lat\":-681,\"lng\":1969,\"label\":\"Brindol\",\"category\":\"city\"},{\"lat\":-1235,\"lng\":1447,\"label\":\"Hammerfist Hold\",\"category\":\"city\"}]"
    }
  },
  {
    "id": "9008196f-350a-455f-a339-1adef7f7de70",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "The Witchwood",
    "description": "A haunted, lush wetland forest northwest of Drellin's Ferry with subtropical evergreens, oaks, and dense undergrowth interspersed with swampy stretches. The forest is corrupted by blighted magic that creates illusions, distorts perception, and causes travelers to walk in circles. Ancient human druidic spirits are said to haunt its depths. The forest contains Wrath Keep, the Strategic Bridge, and numerous Red Hand encampments. Recent battles have seen massive casualties here, including the destruction of the bridge and several enemy fortifications. The area is infested with dangerous creatures including worgs, hydras, and goblin tribes. Any party moving cross-country without following trails risks... [TRUNCATED AT 100 WORDS]",
    "created_at": "2025-11-21T06:40:02.968Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "type": "forest",
      "map_image": "images/assets/map_backgrounds/witchwood_map.jpg"
    }
  }
]

-----------------------------------------
TABLE: narrative_arcs [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  campaign_id               uuid            NOT NULL DEFAULT gen_random_uuid()
  title                     text             
  description               text             
  created_at                timestamp with time zone NOT NULL DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  order                     integer          
  attributes                jsonb            DEFAULT '{}'::jsonb

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "761b8691-c9a3-4a81-bd7b-1500200ad444",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "Thunder and Ash",
    "description": "With the enemy army mere days from Drellin's Ferry, the party makes a desperate gambit: allying with Dreshi, a zealous goblin follower of Lamashtu, to destroy the only bridge across the gorge. The sabotage succeeds spectacularly, buying precious time for the town's evacuation. As refugees flee westward, the party encounters Loraine Martinique, a vampire noble investigating fey portals, and receives troubling news of an alliance between the Archlich of Pahuax and the approaching horde. The arc closes with Drellin's Ferry emptied, its people scattered, and new mysteries beckoning the heroes toward darker conspiracies.",
    "created_at": "2026-01-01T08:15:08.410Z",
    "updated_at": "2026-01-01T08:15:08.410Z",
    "order": 5,
    "attributes": {
      "type": "primary"
    }
  },
  {
    "id": "a9f6e2ea-3fbd-44d4-abc0-c62f94405406",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "Shadows of the Witchwood",
    "description": "Delving into the cursed Witchwood and its flooded cave systems, the party uncovers a nightmare of transmutation experiments and breeding programs. The discovery of Kalistra's arena of horrors - where creatures are twisted and trained for war - reveals the Arcane Brotherhood's dark involvement. As they navigate illusion-shrouded forests and face hydras, megatheriums, and acid-spitting arthropods, the companions realize they've stumbled into something far more sinister than simple raiding parties.",
    "created_at": "2026-01-01T08:13:56.636Z",
    "updated_at": "2026-01-01T08:13:56.636Z",
    "order": 2,
    "attributes": {
      "type": "primary"
    }
  }
]

-----------------------------------------
TABLE: npcs [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  campaign_id               uuid            NOT NULL 
  name                      text            NOT NULL 
  description               text             
  created_at                timestamp with time zone  DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  attributes                jsonb            DEFAULT '{}'::jsonb

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "429c2b28-8a8b-46ec-866d-97259d8de00e",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "Bianca Turiados",
    "description": "Last descendant and true Queen of Pelagos. Fey-touched with lightning-veined eyes.\n",
    "created_at": "2025-11-21T06:46:31.612Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "icon": "../../images/icons/female.png",
      "race": "Human",
      "role": "Ship Co-Commander",
      "gender": "Female",
      "status": "alive",
      "affinity": "Neutral",
      "is_active": "true"
    }
  },
  {
    "id": "ea565b92-b8c1-4e8f-9a05-41d88225a0ff",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "name": "Commander Turiados",
    "description": "7-foot-tall warrior covered in Sahuagin shaman tattoos. Formerly Order of Inos.",
    "created_at": "2025-11-19T21:06:38.740Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "icon": "../../images/icons/male.png",
      "role": "Ship Co-Commander",
      "gender": "Male",
      "status": "alive",
      "affinity": "Neutral",
      "is_active": "true"
    }
  }
]

-----------------------------------------
TABLE: quest_objectives [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  quest_id                  uuid            NOT NULL 
  description               text            NOT NULL 
  status                    text             DEFAULT 'pending'::text
  order_index               integer         NOT NULL 
  completed_session_id      uuid             
  created_at                timestamp with time zone  DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  objective_name            text             
  objective_update          text             

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "1feb6bfc-7071-4c57-ac29-5535a43213e9",
    "quest_id": "812a2b4c-3c16-4270-8a98-9e230331f2dd",
    "description": "Unlock the secrets of the treasure map stolen from the Arcane Brotherhood.",
    "status": "completed",
    "order_index": 1,
    "completed_session_id": "14230e1c-07ea-4fe8-9157-335fb1554508",
    "created_at": "2025-12-20T16:38:33.727Z",
    "updated_at": "2025-12-23T10:50:14.088Z",
    "objective_name": "Decipher the Map",
    "objective_update": "Location identified: Wrath Keep in the Witchwood."
  },
  {
    "id": "7316a460-cda0-4bcb-b991-11fb7d31a843",
    "quest_id": "95322ebe-f77e-4419-8528-d3cd19834750",
    "description": "Travel through the overgrown, subtropical forest road to the town of Drellin's Ferry.",
    "status": "completed",
    "order_index": 1,
    "completed_session_id": "b2f8c12f-b108-4c35-87d1-8ae0e6e98ce5",
    "created_at": "2025-12-20T16:38:33.727Z",
    "updated_at": "2025-12-20T16:39:25.659Z",
    "objective_name": "Reach Drellin's Ferry",
    "objective_update": null
  }
]

-----------------------------------------
TABLE: quests [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  campaign_id               uuid            NOT NULL 
  title                     text            NOT NULL 
  description               text             
  created_at                timestamp with time zone  DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  attributes                jsonb            DEFAULT '{}'::jsonb

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "6f3aa44b-9986-40c7-b33c-9176014d804b",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "The Shadow of Abuse",
    "description": "Olek discovered a woman suffering from domestic abuse after her son asked for help. He healed her wounds but promised to return to speak with the husband.",
    "created_at": "2025-12-20T19:30:42.129Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "status": "Failed",
      "priority": "Low",
      "quest type": "Side Quest"
    }
  },
  {
    "id": "231a3f04-fbd5-4273-bb89-994a177f7792",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "The Missing Barmaid",
    "description": "Anya, a young barmaid at the Green Apple Inn, has gone missing. Her home shows signs of distress, and rumors suggest a troubled relationship with the town guard Lem.",
    "created_at": "2025-12-21T16:43:28.053Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "status": "Completed",
      "priority": "Low",
      "quest type": "Side Quest"
    }
  }
]

-----------------------------------------
TABLE: session_events [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  session_id                uuid            NOT NULL 
  event_order               integer         NOT NULL 
  event_type                text            NOT NULL 
  title                     text            NOT NULL 
  description               text             
  created_at                timestamp with time zone  DEFAULT now()

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "0e5851e2-59b6-4bac-8462-15529735c7fe",
    "session_id": "513d48be-935f-4076-81a5-af859fc708be",
    "event_order": 2,
    "event_type": "backstory",
    "title": "Olek's Reflection",
    "description": "Olek reflected on his path. He recalled the wolves that raised him, the fire that took them, and the celestial pact that saved him. He walked not for glory, but to fulfill the charge given by Helm's servant: to save those in need. His armor shone as a beacon of his devotion, his mind set on the justice he brought to the road ahead.",
    "created_at": "2025-12-20T16:53:37.279Z"
  },
  {
    "id": "0b39202f-621b-4328-96d3-4b3484b2624a",
    "session_id": "513d48be-935f-4076-81a5-af859fc708be",
    "event_order": 1,
    "event_type": "travel",
    "title": "The Assembly on the Green Road",
    "description": "Five unlikely heroes gathered on a winding, overgrown road draped in subtropical greenery. Despite their differing origins—an Aasimar, a Sorcerer, an Eladrin, a Genasi, and a Pixie—they traveled in good spirits. The air was thick with the scent of growth and distant creature calls as they moved toward Drellin's Ferry, united by shared movement if not yet a shared destiny.",
    "created_at": "2025-12-20T16:53:18.468Z"
  }
]

-----------------------------------------
TABLE: sessions [⚠️ RLS DISABLED]
-----------------------------------------
  id                        uuid            NOT NULL DEFAULT gen_random_uuid()
  campaign_id               uuid            NOT NULL 
  title                     text            NOT NULL 
  narrative                 text             
  created_at                timestamp with time zone  DEFAULT now()
  updated_at                timestamp with time zone  DEFAULT now()
  attributes                jsonb            DEFAULT '{}'::jsonb

  -- EXAMPLE DATA (2 rows) --
[
  {
    "id": "20b73069-7a8f-4cd9-aa5b-1c27f40efd79",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "03 - Into the Depths",
    "narrative": "### Return to the Tollhouse The party's previous adventure had left them weary and, frankly, quite malodorous as they returned to Drellin's Ferry. Making their way back to the familiar Tollhouse, they sought out Soranna, who took one look at their disheveled state and quickly ushered them down into the basement. The discrete location would allow them to speak freely without alarming the townspeople with their rather pungent aroma. In the privacy of the basement, the party recounted their harrowing encounters with the attacks they had witnessed. Soranna listened intently as they described the maimed corpses and the disappearance of... [TRUNCATED AT 100 WORDS]",
    "created_at": "2025-11-21T10:53:41.089Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "level_up": "7",
      "campaign_arc": "The Shadow of the Witchwood",
      "session_date": "2025-06-07",
      "session_number": "4"
    }
  },
  {
    "id": "c804ec9f-5c29-416d-9e7c-aa5d32f2a55a",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "05 - Pirates, Pelts, and Cargo",
    "narrative": "### The Leviathan's Hull The party’s ascent from the subterranean hell of the caves had been a desperate, gasping scramble for life. They emerged into the world above only to find themselves adrift on a strange ship in an unknown sea. Their salvation, such as it was, came not as a gentle hand but as a grappling hook. A colossal vessel, all black wood and green-tinged sails, bore down on them. Its name was visible even from a distance: The Leviathan’s Hull. As their small craft was pulled alongside the massive warship, pirates swarmed the deck, their voices rough and... [TRUNCATED AT 100 WORDS]",
    "created_at": "2025-11-21T10:54:53.587Z",
    "updated_at": "2026-01-02T07:53:19.600Z",
    "attributes": {
      "campaign_arc": "The Sunless Conspiracy",
      "session_date": "2025-07-08",
      "session_number": "6"
    }
  }
]

=========================================
   PERFORMANCE INDEXES
=========================================

TABLE: attributes
  CREATE UNIQUE INDEX attributes_pkey ON public.attributes USING btree (id)

TABLE: campaigns
  CREATE UNIQUE INDEX campaigns_campaign_id_key ON public.campaigns USING btree (campaign_id)

TABLE: campaigns
  CREATE UNIQUE INDEX campaigns_pkey ON public.campaigns USING btree (id)

TABLE: characters
  CREATE UNIQUE INDEX characters_pkey ON public.characters USING btree (id)

TABLE: characters
  CREATE INDEX idx_characters_campaign ON public.characters USING btree (campaign_id)

TABLE: encounter_actions
  CREATE UNIQUE INDEX encounter_actions_pkey ON public.encounter_actions USING btree (id)

TABLE: encounters
  CREATE UNIQUE INDEX encounters_pkey ON public.encounters USING btree (id)

TABLE: encounters
  CREATE INDEX idx_encounters_campaign ON public.encounters USING btree (campaign_id)

TABLE: entities
  CREATE UNIQUE INDEX entities_pkey ON public.entities USING btree (id)

TABLE: entity_relationships
  CREATE UNIQUE INDEX entity_relationships_pkey ON public.entity_relationships USING btree (id)

TABLE: entity_relationships
  CREATE INDEX idx_entity_relationships_bidirectional ON public.entity_relationships USING btree (to_entity_id, from_entity_id) WHERE (is_bidirectional = true)

TABLE: entity_relationships
  CREATE INDEX idx_entity_relationships_composite ON public.entity_relationships USING btree (from_entity_id, to_entity_id)

TABLE: entity_relationships
  CREATE UNIQUE INDEX unique_relationship ON public.entity_relationships USING btree (from_entity_id, to_entity_id, relationship_type)

TABLE: factions
  CREATE UNIQUE INDEX factions_campaign_name_unique ON public.factions USING btree (campaign_id, name)

TABLE: factions
  CREATE UNIQUE INDEX factions_pkey ON public.factions USING btree (id)

TABLE: factions
  CREATE INDEX idx_factions_campaign ON public.factions USING btree (campaign_id)

TABLE: factions
  CREATE INDEX idx_factions_name ON public.factions USING btree (name)

TABLE: items
  CREATE UNIQUE INDEX items_pkey ON public.items USING btree (id)

TABLE: locations
  CREATE INDEX idx_locations_campaign ON public.locations USING btree (campaign_id)

TABLE: locations
  CREATE INDEX idx_locations_name ON public.locations USING btree (name)

TABLE: locations
  CREATE UNIQUE INDEX locations_pkey ON public.locations USING btree (id)

TABLE: narrative_arcs
  CREATE UNIQUE INDEX narrative_arcs_pkey ON public.narrative_arcs USING btree (id)

TABLE: npcs
  CREATE INDEX idx_npcs_campaign ON public.npcs USING btree (campaign_id)

TABLE: npcs
  CREATE INDEX idx_npcs_name ON public.npcs USING btree (name)

TABLE: npcs
  CREATE UNIQUE INDEX npcs_pkey ON public.npcs USING btree (id)

TABLE: quest_objectives
  CREATE INDEX idx_quest_objectives_quest ON public.quest_objectives USING btree (quest_id)

TABLE: quest_objectives
  CREATE UNIQUE INDEX quest_objectives_pkey ON public.quest_objectives USING btree (id)

TABLE: quests
  CREATE INDEX idx_quests_campaign ON public.quests USING btree (campaign_id)

TABLE: quests
  CREATE INDEX idx_quests_status ON public.quests USING gin (((attributes -> 'status'::text)))

TABLE: quests
  CREATE INDEX idx_quests_status_jsonb ON public.quests USING gin (((attributes -> 'status'::text)))

TABLE: quests
  CREATE UNIQUE INDEX quests_pkey ON public.quests USING btree (id)

TABLE: session_events
  CREATE INDEX idx_session_events_session ON public.session_events USING btree (session_id, event_order)

TABLE: session_events
  CREATE UNIQUE INDEX session_events_order_unique ON public.session_events USING btree (session_id, event_order)

TABLE: session_events
  CREATE UNIQUE INDEX session_events_pkey ON public.session_events USING btree (id)

TABLE: sessions
  CREATE INDEX idx_sessions_number ON public.sessions USING gin (((attributes -> 'session_number'::text)))

TABLE: sessions
  CREATE INDEX idx_sessions_number_jsonb ON public.sessions USING gin (((attributes -> 'session_number'::text)))

TABLE: sessions
  CREATE UNIQUE INDEX sessions_pkey ON public.sessions USING btree (id)

=========================================
   SECURITY POLICIES (RLS)
=========================================

No RLS Policies found.

=========================================
   VIEWS
=========================================

VIEW: entity_complete_view
-----------------------------------------
 SELECT e.id,
  e.type,
  e.name,
  e.description,
  e.campaign_id,
  e.created_at,
  COALESCE(attr.attributes, '{}'::jsonb) AS attributes,
  COALESCE(rels.relationships, '[]'::jsonb) AS relationships,
  COALESCE(events.events, '{}'::jsonb) AS events
  FROM (((entities e
  LEFT JOIN LATERAL ( SELECT COALESCE(jsonb_object_agg(attr_grouped.name, attr_grouped."values"), '{}'::jsonb) AS attributes
  FROM ( SELECT a.name,
  jsonb_agg(jsonb_build_object('id', a.id, 'value', a.value, 'is_private', a.is_private) ORDER BY a.id) AS "values"
  FROM attributes a
  WHERE (a.entity_id = e.id)
  GROUP BY a.name) attr_grouped
  WHERE (attr_grouped.name IS NOT NULL)) attr ON (true))
  LEFT JOIN LATERAL ( SELECT COALESCE(jsonb_agg(rel_combined.rel_obj), '[]'::jsonb) AS relationships
  FROM ( SELECT jsonb_build_object('relationship_id', er_out.id, 'direction', 'outgoing', 'type', er_out.relationship_type, 'entity_id', er_out.to_entity_id, 'entity_name', e_to.name, 'entity_type', e_to.type, 'description', er_out.description, 'is_bidirectional', false) AS rel_obj
  FROM (entity_relationships er_out
  JOIN entities e_to ON ((e_to.id = er_out.to_entity_id)))
  WHERE ((er_out.from_entity_id = e.id) AND (er_out.is_bidirectional = false) AND (e_to.type <> 'event'::text))
  UNION ALL
  SELECT jsonb_build_object('relationship_id', er_out.id, 'direction', 'bidirectional', 'type', er_out.relationship_type, 'entity_id', er_out.to_entity_id, 'entity_name', e_to.name, 'entity_type', e_to.type, 'description', er_out.description, 'is_bidirectional', true) AS rel_obj
  FROM (entity_relationships er_out
  JOIN entities e_to ON ((e_to.id = er_out.to_entity_id)))
  WHERE ((er_out.from_entity_id = e.id) AND (er_out.is_bidirectional = true) AND (e_to.type <> 'event'::text))
  UNION ALL
  SELECT jsonb_build_object('relationship_id', er_in.id, 'direction', 'incoming', 'type', er_in.relationship_type, 'entity_id', er_in.from_entity_id, 'entity_name', e_from.name, 'entity_type', e_from.type, 'description', er_in.description, 'is_bidirectional', false) AS rel_obj
  FROM (entity_relationships er_in
  JOIN entities e_from ON ((e_from.id = er_in.from_entity_id)))
  WHERE ((er_in.to_entity_id = e.id) AND (er_in.is_bidirectional = false) AND (e_from.type <> 'event'::text))) rel_combined) rels ON (true))
  LEFT JOIN LATERAL ( SELECT COALESCE(jsonb_object_agg(macro_events.macro_type, macro_events.events_array), '{}'::jsonb) AS events
  FROM ( SELECT macro_events_inner.macro_type,
  jsonb_agg(macro_events_inner.event_obj ORDER BY macro_events_inner.event_order, macro_events_inner.id) AS events_array
  FROM ( SELECT 'event'::text AS macro_type,
  e_event.id,
  se_out.event_order,
  jsonb_build_object('id', e_event.id, 'event_type', COALESCE(se_out.event_type, ('relationship_'::text || er_event.relationship_type)), 'title', e_event.name, 'description', e_event.description, 'order', se_out.event_order, 'session_id', se_out.session_id, 'created_at', e_event.created_at, 'relationship_id', er_event.id, 'relationship_type', er_event.relationship_type, 'relationship_direction', 'outgoing') AS event_obj
  FROM ((entity_relationships er_event
  JOIN entities e_event ON ((e_event.id = er_event.to_entity_id)))
  LEFT JOIN session_events se_out ON ((se_out.id = e_event.id)))
  WHERE ((er_event.from_entity_id = e.id) AND (e_event.type = 'event'::text))
  UNION ALL
  SELECT 'event'::text AS macro_type,
  e_event.id,
  se_in.event_order,
  jsonb_build_object('id', e_event.id, 'event_type', COALESCE(se_in.event_type, ('relationship_'::text || er_event_in.relationship_type)), 'title', e_event.name, 'description', e_event.description, 'order', se_in.event_order, 'session_id', se_in.session_id, 'created_at', e_event.created_at, 'relationship_id', er_event_in.id, 'relationship_type', er_event_in.relationship_type, 'relationship_direction', 'incoming') AS event_obj
  FROM ((entity_relationships er_event_in
  JOIN entities e_event ON ((e_event.id = er_event_in.from_entity_id)))
  LEFT JOIN session_events se_in ON ((se_in.id = e_event.id)))
  WHERE ((er_event_in.to_entity_id = e.id) AND (e_event.type = 'event'::text) AND (er_event_in.is_bidirectional = false))) macro_events_inner
  GROUP BY macro_events_inner.macro_type) macro_events
  WHERE (macro_events.macro_type IS NOT NULL)) events ON (true));

  -- VIEW EXAMPLE RESULT --
[
  {
    "id": "429c2b28-8a8b-46ec-866d-97259d8de00e",
    "type": "npc",
    "name": "Bianca Turiados",
    "description": "Last descendant and true Queen of Pelagos. Fey-touched with lightning-veined eyes.\n",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "created_at": "2025-11-21T06:46:31.612Z",
    "attributes": {
      "icon": [
        {
          "id": "520ae8f1-5ccb-4cbb-a96f-f1258a35368d",
          "value": "../../images/icons/female.png",
          "is_private": false
        }
      ],
      "race": [
        {
          "id": "e55167a8-2b67-42f7-a2d2-92771d721498",
          "value": "Human",
          "is_private": false
        }
      ],
      "role": [
        {
          "id": "b82d9572-663e-48ed-a446-301840a410a8",
          "value": "Ship Co-Commander",
          "is_private": false
        }
      ],
      "gender": [
        {
          "id": "61d884e1-21b0-43bd-a2f7-365db306dbab",
          "value": "Female",
          "is_private": false
        }
      ],
      "status": [
        {
          "id": "af773613-bac8-495d-8fb1-e07cbc9b0f46",
          "value": "alive",
          "is_private": false
        }
      ],
      "affinity": [
        {
          "id": "053d37c7-2463-44fb-9073-2b982da95021",
          "value": "Neutral",
          "is_private": false
        }
      ],
      "is_active": [
        {
          "id": "04bfb799-3576-4be2-9c22-cad32707fbf6",
          "value": "true",
          "is_private": false
        }
      ]
    },
    "relationships": [
      {
        "type": "enemy",
        "direction": "outgoing",
        "entity_id": "72cfbf66-7b3b-1a10-12c7-065220922391",
        "description": "Killed her father and stole her throne.",
        "entity_name": "Sandro",
        "entity_type": "npc",
        "relationship_id": "8381aa42-a239-4a8d-b887-064cf24a76bf",
        "is_bidirectional": false
      },
      {
        "type": "encountered",
        "direction": "bidirectional",
        "entity_id": "14230e1c-07ea-4fe8-9157-335fb1554508",
        "description": null,
        "entity_name": "04 - Echoes of the Arena",
        "entity_type": "session",
        "relationship_id": "f326467e-227e-4b2c-a34c-a511a0cb95f8",
        "is_bidirectional": true
      },
      {
        "type": "member_of",
        "direction": "bidirectional",
        "entity_id": "1cbdb828-5aff-4269-bf57-8ef58fe559e6",
        "description": null,
        "entity_name": "The Leviathan's Hull Crew",
        "entity_type": "faction",
        "relationship_id": "82e03444-0a4f-4566-8b23-a4a8f9df8f8d",
        "is_bidirectional": true
      },
      {
        "type": "professional_relation",
        "direction": "bidirectional",
        "entity_id": "94e1d188-9e5d-7632-d4e9-62188658895d",
        "description": "Wishes he was present for guidance.",
        "entity_name": "General Lee",
        "entity_type": "npc",
        "relationship_id": "164c9a02-e144-4a0d-be9e-866ba5c508f4",
        "is_bidirectional": true
      },
      {
        "type": "professional_relation",
        "direction": "bidirectional",
        "entity_id": "964c0ea9-838b-46b0-a606-8d109749624f",
        "description": "Ice elemental quartermaster and advisor.",
        "entity_name": "Glass",
        "entity_type": "npc",
        "relationship_id": "fa8c2cce-7114-47b4-b0dc-63c51f98e58b",
        "is_bidirectional": true
      },
      {
        "type": "professional_relation",
        "direction": "bidirectional",
        "entity_id": "9977cad2-0e29-4283-8c57-b802db493c82",
        "description": null,
        "entity_name": "Bardin Cratcho",
        "entity_type": "npc",
        "relationship_id": "2d0fad3d-0d14-4459-ba5b-d558b2294c4b",
        "is_bidirectional": true
      },
      {
        "type": "encountered",
        "direction": "bidirectional",
        "entity_id": "c804ec9f-5c29-416d-9e7c-aa5d32f2a55a",
        "description": null,
        "entity_name": "05 - Pirates, Pelts, and Cargo",
        "entity_type": "session",
        "relationship_id": "14c5fff1-07fb-42c9-8839-d37904ed7302",
        "is_bidirectional": true
      },
      {
        "type": "leadership_relation",
        "direction": "bidirectional",
        "entity_id": "ca9a1d7f-9a35-4a66-b14d-3237c267a948",
        "description": null,
        "entity_name": "The Leviathan's Hull",
        "entity_type": "location",
        "relationship_id": "56b329a0-6dad-4fb7-99c6-8138816dee71",
        "is_bidirectional": true
      },
      {
        "type": "affiliated_with",
        "direction": "bidirectional",
        "entity_id": "ea565b92-b8c1-4e8f-9a05-41d88225a0ff",
        "description": "Joint command of Leviathan's Hall.",
        "entity_name": "Commander Turiados",
        "entity_type": "npc",
        "relationship_id": "a741f305-df39-455e-9e68-68a00e6d4f64",
        "is_bidirectional": true
      },
      {
        "type": "encountered",
        "direction": "bidirectional",
        "entity_id": "f8a98301-deef-4224-8c8e-f5dcb5343560",
        "description": null,
        "entity_name": "Guests of the Leviathan",
        "entity_type": "quest",
        "relationship_id": "12e298a3-b703-468f-a7c8-5305fe0d3573",
        "is_bidirectional": true
      }
    ],
    "events": {
      "event": [
        {
          "id": "aa1e8981-64cd-4c4c-a365-8d8d1d37a41a",
          "order": 1,
          "title": "Boarding The Leviathan's Hull",
          "created_at": "2025-12-22T05:55:13.945783+00:00",
          "event_type": "npc_encountered",
          "session_id": "c804ec9f-5c29-416d-9e7c-aa5d32f2a55a",
          "description": "After a desperate ascent from the collapsing caves, the Party is hauled from the sea onto the deck of the massive warship The Leviathan's Hull. They are confronted by Commander Turiados, a towering figure clad in wyvern hide with Sahuagin tattoos, and Captain Bianca Turiados, a Fey-touched woman of regal bearing. Soshi chills to recognize that both commanders wield stolen relics from The Arcane Brotherhood: the Breaker of Hulls cutlass and the Winder dagger.",
          "relationship_id": "6ac450c0-c60e-4d12-8ecf-b342a81f27fb",
          "relationship_type": "encountered",
          "relationship_direction": "outgoing"
        },
        {
          "id": "5ec28e3a-4267-4088-b74d-b4dedfe39a11",
          "order": 2,
          "title": "The Queen's Tale",
          "created_at": "2025-12-22T05:55:27.446809+00:00",
          "event_type": "social",
          "session_id": "c804ec9f-5c29-416d-9e7c-aa5d32f2a55a",
          "description": "On the bridge, a confusion over geography reveals that the pirates are hopelessly lost, seeking the archipelago of Nautica far to the south. Captain Bianca Turiados reveals her true identity as the exiled Queen of Pelagos from the continent of Lustria. She recounts how a sudden regrowth of the deep jungles ended their war with lizardfolk, only for civil strife to allow the necromancer Sandro to usurp her throne.",
          "relationship_id": "a94ebadd-c757-4e86-a515-75f8ce03cf48",
          "relationship_type": "encountered",
          "relationship_direction": "outgoing"
        },
        {
          "id": "9853ce61-e637-44ce-88c3-ec8d2c0c9356",
          "order": 5,
          "title": "A Cursed Negotiation",
          "created_at": "2025-12-22T05:57:29.897259+00:00",
          "event_type": "npc_encountered",
          "session_id": "c804ec9f-5c29-416d-9e7c-aa5d32f2a55a",
          "description": "Glass, the ship's Ice Elemental Quartermaster, assesses the party's assets for the 20% rescue fee. When Bonnie attempts to pass off their cursed copper coins, Glass recoils but permits them to keep the \"infected\" currency. Instead, the pirates confiscate Olek's javelins, Norr's rope, and their pearls. Bonnie's final attempt to drop a cursed coin on the deck earns her a punitive magical blast from Captain Bianca Turiados.",
          "relationship_id": "335d1e23-7084-440f-a29f-00937444a188",
          "relationship_type": "encountered",
          "relationship_direction": "outgoing"
        },
        {
          "id": "759fdd11-b07a-4b88-8816-f16ef41e2802",
          "order": 9,
          "title": "Guests of the Leviathan",
          "created_at": "2025-12-21T21:46:41.284256+00:00",
          "event_type": "quest_started",
          "session_id": "14230e1c-07ea-4fe8-9157-335fb1554508",
          "description": "Clinging to debris in the open sea, the battered survivors are approached by the warship The Leviathan's Hull. The crew, a bizarre mix of pirates and armored paladins, fishes the party out of the water, where they are greeted as \"new guests\" by Captain Bianca and her former Paladin partner, Captain Turiados.",
          "relationship_id": "63c70a7a-b4a7-4856-b49b-9b7a695acfb3",
          "relationship_type": "encountered",
          "relationship_direction": "outgoing"
        }
      ]
    }
  },
  {
    "id": "ea565b92-b8c1-4e8f-9a05-41d88225a0ff",
    "type": "npc",
    "name": "Commander Turiados",
    "description": "7-foot-tall warrior covered in Sahuagin shaman tattoos. Formerly Order of Inos.",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "created_at": "2025-11-19T21:06:38.740Z",
    "attributes": {
      "icon": [
        {
          "id": "1b75ad65-b7f0-4846-8870-8ad115b18775",
          "value": "../../images/icons/male.png",
          "is_private": false
        }
      ],
      "role": [
        {
          "id": "dd2d7a98-fc68-4cd0-8a1e-180904dc6f1d",
          "value": "Ship Co-Commander",
          "is_private": false
        }
      ],
      "gender": [
        {
          "id": "f0234b8b-35e6-4736-af6a-a1420dc8731d",
          "value": "Male",
          "is_private": false
        }
      ],
      "status": [
        {
          "id": "b519f49f-46c6-4789-98bf-99ead22a8123",
          "value": "alive",
          "is_private": false
        }
      ],
      "affinity": [
        {
          "id": "8590c92f-316c-4d59-8f62-35a1af374a0e",
          "value": "Neutral",
          "is_private": false
        }
      ],
      "is_active": [
        {
          "id": "153c97ba-b6fe-4976-9f59-8eac87a1ebe6",
          "value": "true",
          "is_private": false
        }
      ]
    },
    "relationships": [
      {
        "type": "encountered",
        "direction": "bidirectional",
        "entity_id": "14230e1c-07ea-4fe8-9157-335fb1554508",
        "description": null,
        "entity_name": "04 - Echoes of the Arena",
        "entity_type": "session",
        "relationship_id": "14770e25-83b6-4eb3-bf17-8878200d8591",
        "is_bidirectional": true
      },
      {
        "type": "member_of",
        "direction": "bidirectional",
        "entity_id": "1cbdb828-5aff-4269-bf57-8ef58fe559e6",
        "description": "Member of the crew.",
        "entity_name": "The Leviathan's Hull Crew",
        "entity_type": "faction",
        "relationship_id": "b4659e79-8453-49a3-952d-1a993f2f42aa",
        "is_bidirectional": true
      },
      {
        "type": "affiliated_with",
        "direction": "bidirectional",
        "entity_id": "429c2b28-8a8b-46ec-866d-97259d8de00e",
        "description": "Joint command of Leviathan's Hall.",
        "entity_name": "Bianca Turiados",
        "entity_type": "npc",
        "relationship_id": "c27e1d6d-f226-4a8e-bcb7-4dda8df0c265",
        "is_bidirectional": true
      },
      {
        "type": "enemy",
        "direction": "bidirectional",
        "entity_id": "72cfbf66-7b3b-1a10-12c7-065220922391",
        "description": "Seeks revenge for village massacre.",
        "entity_name": "Sandro",
        "entity_type": "npc",
        "relationship_id": "66fe289c-7dd8-404e-9fbf-34e1b4a18a6e",
        "is_bidirectional": true
      },
      {
        "type": "encountered",
        "direction": "bidirectional",
        "entity_id": "94e1d188-9e5d-7632-d4e9-62188658895d",
        "description": "Former mercenary leader, whereabouts unknown.",
        "entity_name": "General Lee",
        "entity_type": "npc",
        "relationship_id": "aabea851-0de2-4356-b214-436c224762cd",
        "is_bidirectional": true
      },
      {
        "type": "quest_giver",
        "direction": "bidirectional",
        "entity_id": "afe69839-25b9-466a-8f07-47401383a8ad",
        "description": null,
        "entity_name": "Hunt for the Necromancer King",
        "entity_type": "quest",
        "relationship_id": "0d5b407f-4bd5-4472-9abc-8b7a328426b0",
        "is_bidirectional": true
      },
      {
        "type": "encountered",
        "direction": "bidirectional",
        "entity_id": "c804ec9f-5c29-416d-9e7c-aa5d32f2a55a",
        "description": null,
        "entity_name": "05 - Pirates, Pelts, and Cargo",
        "entity_type": "session",
        "relationship_id": "74ede487-53fa-41c7-bda8-6f460e21af3f",
        "is_bidirectional": true
      },
      {
        "type": "located_in",
        "direction": "bidirectional",
        "entity_id": "ca9a1d7f-9a35-4a66-b14d-3237c267a948",
        "description": "Current location.",
        "entity_name": "The Leviathan's Hull",
        "entity_type": "location",
        "relationship_id": "5b48be19-7586-4ed0-a238-849d4f2603d2",
        "is_bidirectional": true
      }
    ],
    "events": {
      "event": [
        {
          "id": "aa1e8981-64cd-4c4c-a365-8d8d1d37a41a",
          "order": 1,
          "title": "Boarding The Leviathan's Hull",
          "created_at": "2025-12-22T05:55:13.945783+00:00",
          "event_type": "npc_encountered",
          "session_id": "c804ec9f-5c29-416d-9e7c-aa5d32f2a55a",
          "description": "After a desperate ascent from the collapsing caves, the Party is hauled from the sea onto the deck of the massive warship The Leviathan's Hull. They are confronted by Commander Turiados, a towering figure clad in wyvern hide with Sahuagin tattoos, and Captain Bianca Turiados, a Fey-touched woman of regal bearing. Soshi chills to recognize that both commanders wield stolen relics from The Arcane Brotherhood: the Breaker of Hulls cutlass and the Winder dagger.",
          "relationship_id": "3653d703-a366-4408-8abd-bdc6937fae0e",
          "relationship_type": "encountered",
          "relationship_direction": "outgoing"
        },
        {
          "id": "02fbdb04-0c51-4f11-9cd2-030ebadd45ee",
          "order": 4,
          "title": "The Necromancer's Price",
          "created_at": "2025-12-22T05:57:12.608147+00:00",
          "event_type": "quest_started",
          "session_id": "c804ec9f-5c29-416d-9e7c-aa5d32f2a55a",
          "description": "Soshi inquires about Commander Turiados's magical compass, which points to the holder's greatest desire. Turiados strikes a bargain: he will trade the compass for the death of the usurper Sandro. He provides the party with a whistle to summon him once they have obtained a lock of the necromancer's hair as proof.",
          "relationship_id": "31a8e7e1-c7e4-417d-aab4-bd5dc8c46667",
          "relationship_type": "quest_giver",
          "relationship_direction": "outgoing"
        },
        {
          "id": "759fdd11-b07a-4b88-8816-f16ef41e2802",
          "order": 9,
          "title": "Guests of the Leviathan",
          "created_at": "2025-12-21T21:46:41.284256+00:00",
          "event_type": "quest_started",
          "session_id": "14230e1c-07ea-4fe8-9157-335fb1554508",
          "description": "Clinging to debris in the open sea, the battered survivors are approached by the warship The Leviathan's Hull. The crew, a bizarre mix of pirates and armored paladins, fishes the party out of the water, where they are greeted as \"new guests\" by Captain Bianca and her former Paladin partner, Captain Turiados.",
          "relationship_id": "f9a80286-9c07-4599-b4d3-1528e0a30bb7",
          "relationship_type": "encountered",
          "relationship_direction": "outgoing"
        }
      ]
    }
  }
]

VIEW: view_recent_sessions
-----------------------------------------
 SELECT id,
  campaign_id,
  title,
  narrative AS description,
  created_at,
  attributes,
  ( SELECT count(*) AS count
  FROM session_events se
  WHERE (se.session_id = s.id)) AS event_count,
  COALESCE(( SELECT jsonb_agg(DISTINCT jsonb_build_object('id', e.id, 'name', e.name, 'type', e.type)) AS jsonb_agg
  FROM (entity_relationships er
  JOIN entities e ON ((er.to_entity_id = e.id)))
  WHERE ((er.from_entity_id = s.id) OR (er.from_entity_id IN ( SELECT session_events.id
  FROM session_events
  WHERE (session_events.session_id = s.id))))), '[]'::jsonb) AS mentions
  FROM sessions s;

  -- VIEW EXAMPLE RESULT --
[
  {
    "id": "20b73069-7a8f-4cd9-aa5b-1c27f40efd79",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "03 - Into the Depths",
    "description": "### Return to the Tollhouse The party's previous adventure had left them weary and, frankly, quite malodorous as they returned to Drellin's Ferry. Making their way back to the familiar Tollhouse, they sought out Soranna, who took one look at their disheveled state and quickly ushered them down into the basement. The discrete location would allow them to speak freely without alarming the townspeople with their rather pungent aroma. In the privacy of the basement, the party recounted their harrowing encounters with the attacks they had witnessed. Soranna listened intently as they described the maimed corpses and the disappearance of... [TRUNCATED AT 100 WORDS]",
    "created_at": "2025-11-21T10:53:41.089Z",
    "attributes": {
      "level_up": "7",
      "campaign_arc": "The Shadow of the Witchwood",
      "session_date": "2025-06-07",
      "session_number": "4"
    },
    "event_count": "16",
    "mentions": [
      {
        "id": "003af3ae-ce27-4139-8214-96eb96d5181d",
        "name": "Underground Temple Complex",
        "type": "location"
      },
      {
        "id": "0570c3f6-9a26-45c2-96cc-bbe3ab5b25ee",
        "name": "Loïc",
        "type": "npc"
      },
      {
        "id": "0b5848ff-04c4-a3a9-ab50-954119811280",
        "name": "Yoghurt",
        "type": "npc"
      },
      {
        "id": "1c695900-15d5-b4ba-bc61-065220922391",
        "name": "Matron Zaya",
        "type": "npc"
      },
      {
        "id": "22de4109-6224-474a-9104-bc044c5562d2",
        "name": "Party",
        "type": "character"
      },
      {
        "id": "231a3f04-fbd5-4273-bb89-994a177f7792",
        "name": "The Missing Barmaid",
        "type": "quest"
      },
      {
        "id": "35b13ecc-3d2e-4d54-b85b-7c786d25b6a3",
        "name": "The Hydra's Offspring",
        "type": "quest"
      },
      {
        "id": "46065633-d1ec-47e4-a466-700930f84738",
        "name": "The Winter Rose",
        "type": "faction"
      },
      {
        "id": "61f8a855-6b2a-4309-a1b6-39855325562a",
        "name": "Avarthel",
        "type": "npc"
      },
      {
        "id": "646f15d5-34d1-49d0-81f4-df92669e22b6",
        "name": "The Thieves' Guild",
        "type": "faction"
      },
      {
        "id": "77c2cdf3-1109-4628-aa52-0a6523ec0b03",
        "name": "Avarthel's Grove",
        "type": "location"
      },
      {
        "id": "78700f6d-11a7-4ae0-ab50-a1a1b498c1d7",
        "name": "Kaedin",
        "type": "character"
      },
      {
        "id": "83d0c077-8c4c-2b21-23d8-176331033402",
        "name": "Scoundrel",
        "type": "npc"
      },
      {
        "id": "83f32cbe-003d-44ca-b43f-7cd4ea2f3e78",
        "name": "Soshi",
        "type": "character"
      },
      {
        "id": "8427e65e-de6e-4419-b404-73b9704d9543",
        "name": "Bonnie",
        "type": "character"
      },
      {
        "id": "9008196f-350a-455f-a339-1adef7f7de70",
        "name": "The Witchwood",
        "type": "location"
      },
      {
        "id": "94e1d188-9d5d-3c32-34e9-287442144513",
        "name": "Soranna Anitah",
        "type": "npc"
      },
      {
        "id": "99d9dfaa-835b-44c3-a840-97a8ad1fad42",
        "name": "Green Apple Inn",
        "type": "location"
      },
      {
        "id": "a7709e0f-0383-4a82-a87e-46986766d36e",
        "name": "Drellin's Ferry",
        "type": "location"
      },
      {
        "id": "a9f6e2ea-3fbd-44d4-abc0-c62f94405406",
        "name": "Shadows of the Witchwood",
        "type": "narrative_arc"
      },
      {
        "id": "b603f3aa-bf7f-5e54-560b-409664366735",
        "name": "Tharma",
        "type": "npc"
      },
      {
        "id": "bb39bb76-89ee-40c8-a380-5c2ae0a422ed",
        "name": "The Underground Infiltration",
        "type": "quest"
      },
      {
        "id": "c555bcd2-a3bc-49be-8240-a8df5360d476",
        "name": "Lem",
        "type": "npc"
      },
      {
        "id": "d82515cc-d191-7076-782d-621886588957",
        "name": "Vandal",
        "type": "npc"
      },
      {
        "id": "e09a7bfa-fde1-44a6-80f0-7b8f216deaf1",
        "name": "The Lion's Guard",
        "type": "faction"
      },
      {
        "id": "e11e864f-2baa-44d3-8b4a-5b816928cd25",
        "name": "Anya",
        "type": "npc"
      },
      {
        "id": "f1a30dd3-aebf-4bab-8b62-67ca4b68cd87",
        "name": "Jareth",
        "type": "npc"
      },
      {
        "id": "ffadbca2-50fa-489d-9756-ce390d274cd3",
        "name": "Kat",
        "type": "npc"
      }
    ]
  },
  {
    "id": "c804ec9f-5c29-416d-9e7c-aa5d32f2a55a",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "05 - Pirates, Pelts, and Cargo",
    "description": "### The Leviathan's Hull The party’s ascent from the subterranean hell of the caves had been a desperate, gasping scramble for life. They emerged into the world above only to find themselves adrift on a strange ship in an unknown sea. Their salvation, such as it was, came not as a gentle hand but as a grappling hook. A colossal vessel, all black wood and green-tinged sails, bore down on them. Its name was visible even from a distance: The Leviathan’s Hull. As their small craft was pulled alongside the massive warship, pirates swarmed the deck, their voices rough and... [TRUNCATED AT 100 WORDS]",
    "created_at": "2025-11-21T10:54:53.587Z",
    "attributes": {
      "campaign_arc": "The Sunless Conspiracy",
      "session_date": "2025-07-08",
      "session_number": "6"
    },
    "event_count": "11",
    "mentions": [
      {
        "id": "0066c9b0-10ec-4a5b-815c-6d60a9764478",
        "name": "The Crazy Hogs",
        "type": "faction"
      },
      {
        "id": "0490b3a5-4616-40da-848d-394ded179b62",
        "name": "Circle of the Land",
        "type": "faction"
      },
      {
        "id": "1cbdb828-5aff-4269-bf57-8ef58fe559e6",
        "name": "The Leviathan's Hull Crew",
        "type": "faction"
      },
      {
        "id": "22de4109-6224-474a-9104-bc044c5562d2",
        "name": "Party",
        "type": "character"
      },
      {
        "id": "29de2f8f-40de-4813-9672-ee982e8372e8",
        "name": "Pelagos",
        "type": "location"
      },
      {
        "id": "429c2b28-8a8b-46ec-866d-97259d8de00e",
        "name": "Bianca Turiados",
        "type": "npc"
      },
      {
        "id": "4eb21ab1-71f5-4226-ad53-e4c37fc7c1f5",
        "name": "Brother Denny",
        "type": "npc"
      },
      {
        "id": "5d8c1d4a-6ea3-4e62-8a67-65f55104059f",
        "name": "Marise Curs",
        "type": "npc"
      },
      {
        "id": "72cfbf66-7b3b-1a10-12c7-065220922391",
        "name": "Sandro",
        "type": "npc"
      },
      {
        "id": "77c2cdf3-1109-4628-aa52-0a6523ec0b03",
        "name": "Avarthel's Grove",
        "type": "location"
      },
      {
        "id": "78700f6d-11a7-4ae0-ab50-a1a1b498c1d7",
        "name": "Kaedin",
        "type": "character"
      },
      {
        "id": "812a2b4c-3c16-4270-8a98-9e230331f2dd",
        "name": "The Brotherhood's Secret",
        "type": "quest"
      },
      {
        "id": "83d0c077-8c4c-2b21-23d8-176331033402",
        "name": "Scoundrel",
        "type": "npc"
      },
      {
        "id": "83f32cbe-003d-44ca-b43f-7cd4ea2f3e78",
        "name": "Soshi",
        "type": "character"
      },
      {
        "id": "8427e65e-de6e-4419-b404-73b9704d9543",
        "name": "Bonnie",
        "type": "character"
      },
      {
        "id": "93d1d0ac-3b0d-46f5-9e2d-37e0c466e6dc",
        "name": "The Arcane Brotherhood",
        "type": "faction"
      },
      {
        "id": "94e1d188-9e5d-7632-d4e9-62188658895d",
        "name": "General Lee",
        "type": "npc"
      },
      {
        "id": "957b14a8-c53f-4237-a540-9d5c3474bc5f",
        "name": "Norr",
        "type": "character"
      },
      {
        "id": "964c0ea9-838b-46b0-a606-8d109749624f",
        "name": "Glass",
        "type": "npc"
      },
      {
        "id": "9977cad2-0e29-4283-8c57-b802db493c82",
        "name": "Bardin Cratcho",
        "type": "npc"
      },
      {
        "id": "99d9dfaa-835b-44c3-a840-97a8ad1fad42",
        "name": "Green Apple Inn",
        "type": "location"
      },
      {
        "id": "afe69839-25b9-466a-8f07-47401383a8ad",
        "name": "Hunt for the Necromancer King",
        "type": "quest"
      },
      {
        "id": "bb98adb9-4467-4e04-bb48-343102c0ce5a",
        "name": "Lustria",
        "type": "location"
      },
      {
        "id": "bf063127-7e5a-48c4-a7e7-49103921a3c8",
        "name": "The Thylacoleo Cubs",
        "type": "quest"
      },
      {
        "id": "c8ae0ed1-edba-4330-8853-a59cc6ea416d",
        "name": "The Pirate Bargain",
        "type": "narrative_arc"
      },
      {
        "id": "ca9a1d7f-9a35-4a66-b14d-3237c267a948",
        "name": "The Leviathan's Hull",
        "type": "location"
      },
      {
        "id": "caaa5274-9764-4922-ac11-106da710fc2c",
        "name": "Sertieren",
        "type": "npc"
      },
      {
        "id": "d0c69424-fb56-49a4-80fc-8d0b652008b4",
        "name": "The Thylacoleo Ambush",
        "type": "encounter"
      },
      {
        "id": "d761169b-0184-4931-a99f-7c8a67080349",
        "name": "Sertieren's Mansion",
        "type": "location"
      },
      {
        "id": "d82515cc-d191-7076-782d-621886588957",
        "name": "Vandal",
        "type": "npc"
      },
      {
        "id": "e93626dd-e2a2-2187-293e-176331033402",
        "name": "Kalistra",
        "type": "npc"
      },
      {
        "id": "ea565b92-b8c1-4e8f-9a05-41d88225a0ff",
        "name": "Commander Turiados",
        "type": "npc"
      },
      {
        "id": "f8a98301-deef-4224-8c8e-f5dcb5343560",
        "name": "Guests of the Leviathan",
        "type": "quest"
      },
      {
        "id": "fd992811-d20d-4231-9a71-7dadedc7b82c",
        "name": "Olek",
        "type": "character"
      }
    ]
  }
]

VIEW: view_active_quests
-----------------------------------------
 SELECT id,
  campaign_id,
  title,
  attributes,
  updated_at,
  COALESCE(( SELECT jsonb_agg(qo.* ORDER BY qo.order_index) AS jsonb_agg
  FROM quest_objectives qo
  WHERE (qo.quest_id = q.id)), '[]'::jsonb) AS objectives
  FROM quests q
  WHERE (((attributes ->> 'status'::text) ~~* '%active%'::text) OR ((attributes ->> 'status'::text) = 'pending'::text) OR ((attributes ->> 'status'::text) IS NULL));

  -- VIEW EXAMPLE RESULT --
[
  {
    "id": "45e1849e-a9b7-40af-a93a-210029842c18",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "Hunt for the Spider Demon",
    "attributes": {
      "status": "Active",
      "priority": "Medium",
      "quest type": "Side Quest"
    },
    "updated_at": "2026-01-02T07:53:19.600Z",
    "objectives": [
      {
        "id": "e57db412-84b8-4b01-a3fb-7fae31f234d4",
        "status": "active",
        "quest_id": "45e1849e-a9b7-40af-a93a-210029842c18",
        "created_at": "2025-12-21T13:41:11.499955+00:00",
        "updated_at": "2025-12-21T13:41:11.499955+00:00",
        "description": "Locate and slay the demonic creature in the woods.",
        "order_index": 1,
        "objective_name": "Defeat the Spider Demon",
        "objective_update": null,
        "completed_session_id": null
      },
      {
        "id": "e2c02e29-f938-41f1-b0fc-9c4cc6a3d6ad",
        "status": "active",
        "quest_id": "45e1849e-a9b7-40af-a93a-210029842c18",
        "created_at": "2025-12-21T13:41:25.927107+00:00",
        "updated_at": "2025-12-21T13:41:25.927107+00:00",
        "description": "If successful, report the kill to the Captain of the Lion's Guard in Brindol for a reward.",
        "order_index": 2,
        "objective_name": "Report to Captain Hans Mariner",
        "objective_update": null,
        "completed_session_id": null
      }
    ]
  },
  {
    "id": "ecfb0955-d289-4101-9d66-5d0246c580d9",
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "title": "The Festival Of Life",
    "attributes": {
      "status": "Active",
      "priority": "Medium",
      "quest type": "Side Quest"
    },
    "updated_at": "2026-01-02T07:53:19.600Z",
    "objectives": [
      {
        "id": "502dd9f0-d05e-42b0-b74f-873293805109",
        "status": "active",
        "quest_id": "ecfb0955-d289-4101-9d66-5d0246c580d9",
        "created_at": "2025-12-21T19:50:12.078495+00:00",
        "updated_at": "2025-12-21T19:50:29.445474+00:00",
        "description": "Gather information on who Kilgor is and his ultimate goal.",
        "order_index": 1,
        "objective_name": "Identify Kilgor",
        "objective_update": null,
        "completed_session_id": null
      },
      {
        "id": "13d630cc-2b24-402f-b171-4e59eba9e90b",
        "status": "active",
        "quest_id": "ecfb0955-d289-4101-9d66-5d0246c580d9",
        "created_at": "2025-12-21T19:50:25.757544+00:00",
        "updated_at": "2025-12-21T19:50:25.757544+00:00",
        "description": "Discover what the \"Festival of Life\" entails and where it will be held.",
        "order_index": 2,
        "objective_name": " Learn about the Festival",
        "objective_update": null,
        "completed_session_id": null
      }
    ]
  }
]

VIEW: view_dashboard_stats
-----------------------------------------
 WITH top_loc AS (
  SELECT l.campaign_id,
  l.name,
  count(er.id) AS visit_count
  FROM (locations l
  JOIN entity_relationships er ON ((l.id = er.to_entity_id)))
  GROUP BY l.campaign_id, l.name
  ORDER BY (count(er.id)) DESC
  ), top_npc_mentioned AS (
  SELECT n.campaign_id,
  n.name,
  count(er.id) AS mention_count
  FROM (npcs n
  JOIN entity_relationships er ON ((n.id = er.to_entity_id)))
  GROUP BY n.campaign_id, n.name
  ORDER BY (count(er.id)) DESC
  ), active_sess AS (
  SELECT s.campaign_id,
  s.id,
  s.title,
  count(se.id) AS event_count
  FROM (sessions s
  JOIN session_events se ON ((s.id = se.session_id)))
  GROUP BY s.campaign_id, s.id, s.title
  ORDER BY (count(se.id)) DESC
  )
  SELECT id AS campaign_id,
  ( SELECT count(*) AS count
  FROM sessions
  WHERE (sessions.campaign_id = c.id)) AS total_sessions,
  ( SELECT count(*) AS count
  FROM encounters
  WHERE (encounters.campaign_id = c.id)) AS total_encounters,
  ( SELECT count(*) AS count
  FROM npcs
  WHERE (npcs.campaign_id = c.id)) AS unique_npcs,
  ( SELECT count(*) AS count
  FROM locations
  WHERE (locations.campaign_id = c.id)) AS unique_locations,
  ( SELECT count(*) AS count
  FROM quests q
  WHERE ((q.campaign_id = c.id) AND (((q.attributes ->> 'status'::text) ~~* '%active%'::text) OR ((q.attributes ->> 'status'::text) = 'pending'::text) OR ((q.attributes ->> 'status'::text) IS NULL)))) AS active_quests,
  ( SELECT count(*) AS count
  FROM quests q
  WHERE ((q.campaign_id = c.id) AND (((q.attributes ->> 'status'::text) ~~* '%completed%'::text) OR ((q.attributes ->> 'status'::text) ~~* '%success%'::text)))) AS completed_quests,
  ( SELECT row_to_json(tl.*) AS row_to_json
  FROM ( SELECT top_loc.name,
  top_loc.visit_count AS visits
  FROM top_loc
  WHERE (top_loc.campaign_id = c.id)
  LIMIT 1) tl) AS top_location,
  ( SELECT row_to_json(tn.*) AS row_to_json
  FROM ( SELECT top_npc_mentioned.name,
  top_npc_mentioned.mention_count AS mentions
  FROM top_npc_mentioned
  WHERE (top_npc_mentioned.campaign_id = c.id)
  LIMIT 1) tn) AS top_npc,
  ( SELECT row_to_json(asess.*) AS row_to_json
  FROM ( SELECT active_sess.id,
  active_sess.title,
  active_sess.event_count
  FROM active_sess
  WHERE (active_sess.campaign_id = c.id)
  LIMIT 1) asess) AS most_active_session
  FROM campaigns c;

  -- VIEW EXAMPLE RESULT --
[
  {
    "campaign_id": "415036c7-08cc-4832-bfec-6daca13e3f8a",
    "total_sessions": "11",
    "total_encounters": "10",
    "unique_npcs": "44",
    "unique_locations": "31",
    "active_quests": "13",
    "completed_quests": "5",
    "top_location": {
      "name": "Drellin's Ferry",
      "visits": 30
    },
    "top_npc": {
      "name": "Soranna Anitah",
      "mentions": 24
    },
    "most_active_session": {
      "id": "20b73069-7a8f-4cd9-aa5b-1c27f40efd79",
      "title": "03 - Into the Depths",
      "event_count": 16
    }
  },
  {
    "campaign_id": "d147179e-fe98-47e4-84ea-b3bb2e4bc238",
    "total_sessions": "8",
    "total_encounters": "0",
    "unique_npcs": "1",
    "unique_locations": "17",
    "active_quests": "0",
    "completed_quests": "0",
    "top_location": {
      "name": "Korinis Island",
      "visits": 8
    },
    "top_npc": {
      "name": "Lobart",
      "mentions": 1
    },
    "most_active_session": null
  }
]

=========================================
   FUNCTIONS
=========================================

FUNCTION: api_search_entities(p_campaign_id uuid, p_search_term text)
-----------------------------------------

BEGIN
  RETURN QUERY
  -- Search generic Entities
  SELECT e.id, e.name, e.type, e.description
  FROM entities e
  WHERE e.campaign_id = p_campaign_id
    AND (e.name ILIKE '%' || p_search_term || '%')
  
  UNION ALL
  
  -- Search Sessions (normalized)
  SELECT s.id, s.title as name, 'session' as type, s.narrative as description
  FROM sessions s
  WHERE s.campaign_id = p_campaign_id
    AND (s.title ILIKE '%' || p_search_term || '%')
  
  LIMIT 20;
END;


FUNCTION: sync_event_to_entity()
-----------------------------------------

BEGIN
  IF (TG_OP = 'INSERT') THEN
    INSERT INTO public.entities (id, type, name, campaign_id, description)
    VALUES (NEW.id, 'event', NEW.title, (SELECT campaign_id FROM sessions WHERE id = NEW.session_id), NEW.description);
  ELSIF (TG_OP = 'UPDATE') THEN
    UPDATE public.entities
    SET name = NEW.title, description = NEW.description
    WHERE id = NEW.id;
  ELSIF (TG_OP = 'DELETE') THEN
    DELETE FROM public.entities WHERE id = OLD.id;
  END IF;
  RETURN NULL;
END;


FUNCTION: api_scan_campaign_text(p_campaign_id uuid, p_term text)
-----------------------------------------

DECLARE
  search_pattern TEXT := '%' || p_term || '%';
BEGIN
  RETURN QUERY
  
  -- 1. Entities (Name & Description)
  SELECT 'entities'::TEXT, e.id, 'name'::TEXT, (e.type || ': ' || e.name)::TEXT, e.name
  FROM entities e WHERE e.campaign_id = p_campaign_id AND e.name ILIKE search_pattern
  UNION ALL
  SELECT 'entities'::TEXT, e.id, 'description'::TEXT, (e.type || ': ' || e.name)::TEXT, e.description
  FROM entities e WHERE e.campaign_id = p_campaign_id AND e.description ILIKE search_pattern
  
  UNION ALL

  -- 2. Sessions (Title & Narrative)
  SELECT 'sessions'::TEXT, s.id, 'title'::TEXT, ('Session: ' || s.title)::TEXT, s.title
  FROM sessions s WHERE s.campaign_id = p_campaign_id AND s.title ILIKE search_pattern
  UNION ALL
  SELECT 'sessions'::TEXT, s.id, 'narrative'::TEXT, ('Session: ' || s.title)::TEXT, s.narrative
  FROM sessions s WHERE s.campaign_id = p_campaign_id AND s.narrative ILIKE search_pattern

  UNION ALL

  -- 3. Session Events (Title & Description)
  SELECT 'session_events'::TEXT, se.id, 'title'::TEXT, ('Event in: ' || s.title)::TEXT, se.title
  FROM session_events se
  JOIN sessions s ON se.session_id = s.id
  WHERE s.campaign_id = p_campaign_id AND se.title ILIKE search_pattern
  UNION ALL
  SELECT 'session_events'::TEXT, se.id, 'description'::TEXT, ('Event in: ' || s.title)::TEXT, se.description
  FROM session_events se
  JOIN sessions s ON se.session_id = s.id
  WHERE s.campaign_id = p_campaign_id AND se.description ILIKE search_pattern

  UNION ALL

  -- 4. Quest Objectives
  SELECT 'quest_objectives'::TEXT, qo.id, 'description'::TEXT, ('Objective in: ' || e.name)::TEXT, qo.description
  FROM quest_objectives qo
  JOIN entities e ON qo.quest_id = e.id
  WHERE e.campaign_id = p_campaign_id AND qo.description ILIKE search_pattern;

END;


FUNCTION: create_reverse_relationship()
-----------------------------------------

BEGIN
  -- Only proceed if is_bidirectional is true
  IF NEW.is_bidirectional = true THEN
    -- Check if reverse relationship already exists to avoid infinite loop
    IF NOT EXISTS (
      SELECT 1 FROM entity_relationships
      WHERE from_entity_id = NEW.to_entity_id
        AND to_entity_id = NEW.from_entity_id
        AND relationship_type = NEW.relationship_type
    ) THEN
      -- Insert the reverse relationship
      INSERT INTO entity_relationships (
        from_entity_id,
        to_entity_id,
        relationship_type,
        description,
        is_bidirectional,
        is_hidden
      ) VALUES (
        NEW.to_entity_id,           -- Swap: to becomes from
        NEW.from_entity_id,          -- Swap: from becomes to
        NEW.relationship_type,
        NEW.description,
        NEW.is_bidirectional,
        NEW.is_hidden
      );
    END IF;
  END IF;
  
  RETURN NEW;
END;


FUNCTION: sync_to_entities()
-----------------------------------------
DECLARE
  entity_type text := TG_ARGV[0];
  entity_name text;
  entity_desc text;
BEGIN
  -- 1. Determine Name and Description based on table type
  IF entity_type = 'quest' OR entity_type = 'narrative_arc' THEN
    entity_name := NEW.title;         
    entity_desc := NEW.description;
  ELSIF entity_type = 'character' THEN
    entity_name := NEW.name;
    entity_desc := NEW.description;
  ELSIF entity_type = 'session' THEN
    entity_name := NEW.title;
    entity_desc := null;
  ELSE
    entity_name := NEW.name;          -- NPCs, Factions, Locations use 'name'
    entity_desc := NEW.description;  
  END IF;

  -- 2. Perform the Sync
  IF (TG_OP = 'INSERT') THEN
    INSERT INTO public.entities (id, campaign_id, type, name, description)
    VALUES (NEW.id, NEW.campaign_id, entity_type, entity_name, entity_desc)
    ON CONFLICT (id) DO UPDATE 
    SET 
      name = EXCLUDED.name,
      description = EXCLUDED.description;
      
  ELSIF (TG_OP = 'UPDATE') THEN
    UPDATE public.entities 
    SET 
      name = entity_name,
      description = entity_desc
    WHERE id = NEW.id;
    
  ELSIF (TG_OP = 'DELETE') THEN
    DELETE FROM public.entities WHERE id = OLD.id;
  END IF;
  
  RETURN NULL;
END;

FUNCTION: update_updated_at()
-----------------------------------------

BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;


=========================================
   TRIGGERS
=========================================

TRIGGER: characters_updated_at ON characters
BEFORE UPDATE
EXECUTE: EXECUTE FUNCTION update_updated_at()

TRIGGER: tr_sync_characters_to_entities ON characters
AFTER INSERT
EXECUTE: EXECUTE FUNCTION sync_to_entities('character')

TRIGGER: tr_sync_characters_to_entities ON characters
AFTER DELETE
EXECUTE: EXECUTE FUNCTION sync_to_entities('character')

TRIGGER: tr_sync_characters_to_entities ON characters
AFTER UPDATE
EXECUTE: EXECUTE FUNCTION sync_to_entities('character')

TRIGGER: encounters_updated_at ON encounters
BEFORE UPDATE
EXECUTE: EXECUTE FUNCTION update_updated_at()

TRIGGER: tr_sync_factions_to_entities ON encounters
AFTER INSERT
EXECUTE: EXECUTE FUNCTION sync_to_entities('encounter')

TRIGGER: tr_sync_factions_to_entities ON encounters
AFTER DELETE
EXECUTE: EXECUTE FUNCTION sync_to_entities('encounter')

TRIGGER: tr_sync_factions_to_entities ON encounters
AFTER UPDATE
EXECUTE: EXECUTE FUNCTION sync_to_entities('encounter')

TRIGGER: create_bidirectional_relationship ON entity_relationships
AFTER INSERT
EXECUTE: EXECUTE FUNCTION create_reverse_relationship()

TRIGGER: factions_updated_at ON factions
BEFORE UPDATE
EXECUTE: EXECUTE FUNCTION update_updated_at()

TRIGGER: tr_sync_factions_to_entities ON factions
AFTER UPDATE
EXECUTE: EXECUTE FUNCTION sync_to_entities('faction')

TRIGGER: tr_sync_factions_to_entities ON factions
AFTER INSERT
EXECUTE: EXECUTE FUNCTION sync_to_entities('faction')

TRIGGER: tr_sync_factions_to_entities ON factions
AFTER DELETE
EXECUTE: EXECUTE FUNCTION sync_to_entities('faction')

TRIGGER: locations_updated_at ON locations
BEFORE UPDATE
EXECUTE: EXECUTE FUNCTION update_updated_at()

TRIGGER: tr_sync_locations_to_entities ON locations
AFTER DELETE
EXECUTE: EXECUTE FUNCTION sync_to_entities('location')

TRIGGER: tr_sync_locations_to_entities ON locations
AFTER INSERT
EXECUTE: EXECUTE FUNCTION sync_to_entities('location')

TRIGGER: tr_sync_locations_to_entities ON locations
AFTER UPDATE
EXECUTE: EXECUTE FUNCTION sync_to_entities('location')

TRIGGER: sync_to_entities ON narrative_arcs
AFTER DELETE
EXECUTE: EXECUTE FUNCTION sync_to_entities('narrative_arc')

TRIGGER: sync_to_entities ON narrative_arcs
AFTER INSERT
EXECUTE: EXECUTE FUNCTION sync_to_entities('narrative_arc')

TRIGGER: sync_to_entities ON narrative_arcs
AFTER UPDATE
EXECUTE: EXECUTE FUNCTION sync_to_entities('narrative_arc')

TRIGGER: npcs_updated_at ON npcs
BEFORE UPDATE
EXECUTE: EXECUTE FUNCTION update_updated_at()

TRIGGER: tr_sync_npcs_to_entities ON npcs
AFTER INSERT
EXECUTE: EXECUTE FUNCTION sync_to_entities('npc')

TRIGGER: tr_sync_npcs_to_entities ON npcs
AFTER DELETE
EXECUTE: EXECUTE FUNCTION sync_to_entities('npc')

TRIGGER: tr_sync_npcs_to_entities ON npcs
AFTER UPDATE
EXECUTE: EXECUTE FUNCTION sync_to_entities('npc')

TRIGGER: quest_objectives_updated_at ON quest_objectives
BEFORE UPDATE
EXECUTE: EXECUTE FUNCTION update_updated_at()

TRIGGER: quests_updated_at ON quests
BEFORE UPDATE
EXECUTE: EXECUTE FUNCTION update_updated_at()

TRIGGER: tr_sync_quests_to_entities ON quests
AFTER DELETE
EXECUTE: EXECUTE FUNCTION sync_to_entities('quest')

TRIGGER: tr_sync_quests_to_entities ON quests
AFTER INSERT
EXECUTE: EXECUTE FUNCTION sync_to_entities('quest')

TRIGGER: tr_sync_quests_to_entities ON quests
AFTER UPDATE
EXECUTE: EXECUTE FUNCTION sync_to_entities('quest')

TRIGGER: trigger_sync_event_entity ON session_events
AFTER UPDATE
EXECUTE: EXECUTE FUNCTION sync_event_to_entity()

TRIGGER: trigger_sync_event_entity ON session_events
AFTER INSERT
EXECUTE: EXECUTE FUNCTION sync_event_to_entity()

TRIGGER: trigger_sync_event_entity ON session_events
AFTER DELETE
EXECUTE: EXECUTE FUNCTION sync_event_to_entity()

TRIGGER: sessions_updated_at ON sessions
BEFORE UPDATE
EXECUTE: EXECUTE FUNCTION update_updated_at()

TRIGGER: sync_to_entities ON sessions
AFTER DELETE
EXECUTE: EXECUTE FUNCTION sync_to_entities('session')

TRIGGER: sync_to_entities ON sessions
AFTER INSERT
EXECUTE: EXECUTE FUNCTION sync_to_entities('session')

TRIGGER: sync_to_entities ON sessions
AFTER UPDATE
EXECUTE: EXECUTE FUNCTION sync_to_entities('session')

