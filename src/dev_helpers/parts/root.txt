================================================================
PARTIAL BUNDLE: ROOT
================================================================

### PROJECT MAP (FILE STRUCTURE)
./
  fix-dark-mode.sh
  main.jsx
  app/
    App.jsx
    AppRoutes.jsx
    components/
      RouteLoading.jsx
    styles/
      global.css
  domain/
    entity/
      api/
        entityService.js
      components/
        EntityBadge.jsx
        EntityIcon.jsx
        EntityLink.jsx
        EntityStatusIcon.jsx
      config/
        entityColors.js
        entityConfig.js
        entityIcons.js
        entityStyles.js
        entityTypes.js
      utils/
        attributeParser.js
        entityUtils.js
        statusUtils.js
  features/
    admin/
      api/
        adminService.js
      components/
        AdminForm.jsx
        AdminFormStyles.js
        EncounterManager.jsx
        EntitySearch.jsx
        EventTagger.jsx
        ImageLibraryModal.jsx
        MarkdownEditor.jsx
        QuestObjectiveManager.jsx
        RelationshipManager.jsx
        SessionEventManager.jsx
        SmartImageInput.jsx
        TacticalMapManager.jsx
      config/
        adminStrategies.js
        imageLibrary.js
        imageManifest.json
      layouts/
        AdminLayout.jsx
      pages/
        BulkReplaceTool.jsx
        EntityEditorPage.jsx
        EntityListPage.jsx
        SplitPaneManager.jsx
    atlas/
      MapPage.jsx
      useMapData.js
      components/
        AtlasSidebar.jsx
        MapCanvas.jsx
        MapTools.jsx
        useMapCanvasViewModel.js
        __MapLayerControl.jsx
        layers/
          MapAreas.jsx
          MapMarkers.jsx
          MapOverlays.jsx
          MapRecaps.jsx
      config/
        mapConfig.js
      data/
      utils/
        mapNavigation.js
        markerUtils.js
    campaign/
      CampaignContext.jsx
      useCampaignPersistence.js
      useCampaignSelection.js
      api/
        campaignService.js
      components/
        CampaignCard.jsx
        CampaignSelect.jsx
    dashboard/
      DashboardPage.jsx
      api/
        dashboardService.js
      components/
        ActiveQuestsWidget.jsx
        CampaignHero.jsx
        LatestSessionCard.jsx
        QuickInsights.jsx
        RecentEncountersWidget.jsx
        RecentSessionsList.jsx
        SessionRecapCard.jsx
    graph/
      GraphPage.jsx
      useGraphView.js
      api/
        graphService.js
      components/
        CytoscapeCanvas.jsx
        GraphLegend.jsx
      config/
        graphStyles.js
      utils/
        graphMapper.js
    navigation/
      MainLayout.jsx
      useNavigation.js
      components/
        Sidebar.jsx
        SidebarFooter.jsx
        SidebarHeader.jsx
        SidebarNav.jsx
      config/
        navConfig.js
    search/
      GlobalSearch.jsx
      SearchContext.jsx
      useGlobalSearch.js
      api/
        searchService.js
      components/
        SearchFooter.jsx
        SearchModal.jsx
        SearchResultItem.jsx
        SearchResults.jsx
        SearchTrigger.jsx
      utils/
        searchMapper.js
    smart-text/
      SmartMarkdown.jsx
      useEntityIndex.js
      useSmartText.js
      components/
        EntityEmbed.jsx
        SmartEntityLink.jsx
    smart-tooltip/
      TooltipContainer.jsx
      TooltipContext.jsx
      useSmartPosition.js
      useTooltipState.js
      components/
        TooltipCard.jsx
    table-of-contents/
      TableOfContents.jsx
      components/
        TocItem.jsx
        TocMobileDrawer.jsx
      hooks/
        useTocObserver.js
        useTocScroll.js
    timeline/
      TimelinePage.jsx
      useTimelineView.js
      api/
        timelineService.js
      components/
        TimelineEvent.jsx
        TimelineSession.jsx
      utils/
        eventStyles.js
    wiki/
      useEntityView.js
      useWikiNavigation.js
      WikiLayout.jsx
      api/
        wikiService.js
      components/
        EncounterTimeline.jsx
        EntityBody.jsx
        EntityHeader.jsx
        EntityHistory.jsx
        EntityMiniMap.jsx
        EntitySidebar.jsx
        QuestObjectives.jsx
        SessionMentions.jsx
        WikiEntryView.jsx
        landing/
          EntityGridCard.jsx
          EntityTableGroup.jsx
          Swimlane.jsx
        navigation/
          SidebarEmptyState.jsx
          WikiSidebar.jsx
          WikiSidebarHeader.jsx
          WikiSidebarList.jsx
          sidebar/
            CollapsibleGroup.jsx
            EntityListItem.jsx
            PriorityIcon.jsx
            SidebarTreeItem.jsx
            StatusIcon.jsx
      config/
        groupingConfig.js
        viewStrategies.js
      hooks/
        useEntityContent.js
        useEntityFetching.js
        useEntityGrouping.js
        useEntityHeader.js
        useEntitySidebar.js
      layouts/
        SessionLayout.jsx
        StandardLayout.jsx
      pages/
        WikiDetailPage.jsx
        WikiLandingPage.jsx
      utils/
        attributeMapper.js
        eventMapper.js
        relationshipMapper.js
        wikiEntryMapper.js
        wikiUtils.js
  shared/
    api/
      supabaseClient.js
    components/
      ErrorBoundary.jsx
      layout/
        CollapsibleSection.jsx
        SplitView.jsx
        TabContainer.jsx
      markdown/
        MarkdownRenderer.jsx
        MarkdownWithToC.jsx
      ui/
        Breadcrumbs.jsx
        Button.jsx
        Card.jsx
        DevAdminButton.jsx
        Drawer.jsx
        EmptyState.jsx
        LoadingSpinner.jsx
        SectionDivider.jsx
    hooks/
      useBreadcrumbs.js
      useTheme.js
    utils/
      imageUtils.js
      markdownUtils.js
      textUtils.js
      theme/
        colorUtils.js
        cssUtils.js

================================================================
### SOURCE CODE
================================================================

--- FILE: fix-dark-mode.sh ---
#!/bin/bash

# Dark Mode Fix Script
# This script performs find-and-replace operations to convert hardcoded colors to theme-aware tokens
# Run this from your project root directory

echo "ðŸŽ¨ Starting Dark Mode Fix Script..."
echo "===================================="

# Function to replace in files
replace_in_files() {
    local search="$1"
    local replace="$2"
    local description="$3"
    
    echo "ðŸ“ $description"
    
    # Use find and sed to replace in all .jsx files
    find features/ -name "*.jsx" -type f -exec sed -i.bak "s/$search/$replace/g" {} \;
    
    # Clean up backup files
    find features/ -name "*.bak" -type f -delete
}

echo ""
echo "ðŸ” Phase 1: Text Colors"
echo "----------------------"

# Foreground colors (dark text)
replace_in_files "text-stone-900" "text-foreground" "Converting text-stone-900 â†’ text-foreground"
replace_in_files "text-stone-800" "text-foreground" "Converting text-stone-800 â†’ text-foreground"
replace_in_files "text-stone-700" "text-card-foreground" "Converting text-stone-700 â†’ text-card-foreground"
replace_in_files "text-gray-900" "text-foreground" "Converting text-gray-900 â†’ text-foreground"
replace_in_files "text-slate-900" "text-foreground" "Converting text-slate-900 â†’ text-foreground"

# Muted text colors
replace_in_files "text-stone-600" "text-muted-foreground" "Converting text-stone-600 â†’ text-muted-foreground"
replace_in_files "text-stone-500" "text-muted-foreground" "Converting text-stone-500 â†’ text-muted-foreground"
replace_in_files "text-stone-400" "text-muted-foreground" "Converting text-stone-400 â†’ text-muted-foreground"
replace_in_files "text-gray-500" "text-muted-foreground" "Converting text-gray-500 â†’ text-muted-foreground"
replace_in_files "text-slate-500" "text-muted-foreground" "Converting text-slate-500 â†’ text-muted-foreground"

echo ""
echo "ðŸŽ¨ Phase 2: Background Colors"
echo "-----------------------------"

# Card backgrounds
replace_in_files "bg-stone-50" "bg-muted" "Converting bg-stone-50 â†’ bg-muted"
replace_in_files "bg-gray-50" "bg-muted" "Converting bg-gray-50 â†’ bg-muted"
replace_in_files "bg-slate-50" "bg-muted" "Converting bg-slate-50 â†’ bg-muted"
replace_in_files "bg-stone-100" "bg-muted" "Converting bg-stone-100 â†’ bg-muted"

# Subtle backgrounds
replace_in_files "bg-stone-200\\/60" "bg-muted\\/80" "Converting bg-stone-200/60 â†’ bg-muted/80"
replace_in_files "bg-stone-200\\/50" "bg-muted\\/60" "Converting bg-stone-200/50 â†’ bg-muted/60"

echo ""
echo "ðŸ”² Phase 3: Border Colors"
echo "-------------------------"

replace_in_files "border-stone-300" "border-border" "Converting border-stone-300 â†’ border-border"
replace_in_files "border-stone-200" "border-border" "Converting border-stone-200 â†’ border-border"
replace_in_files "border-gray-200" "border-border" "Converting border-gray-200 â†’ border-border"
replace_in_files "border-slate-200" "border-border" "Converting border-slate-200 â†’ border-border"

replace_in_files "border-stone-200\\/60" "border-border\\/60" "Converting border-stone-200/60 â†’ border-border/60"
replace_in_files "border-stone-200\\/40" "border-border\\/40" "Converting border-stone-200/40 â†’ border-border/40"

echo ""
echo "ðŸ“Š Phase 4: Divide Colors"
echo "-------------------------"

replace_in_files "divide-stone-200" "divide-border" "Converting divide-stone-200 â†’ divide-border"
replace_in_files "divide-gray-200" "divide-border" "Converting divide-gray-200 â†’ divide-border"

echo ""
echo "ðŸ’ Phase 5: Ring Colors"
echo "-----------------------"

replace_in_files "ring-stone-200" "ring-border" "Converting ring-stone-200 â†’ ring-border"
replace_in_files "ring-gray-200" "ring-border" "Converting ring-gray-200 â†’ ring-border"

echo ""
echo "âœ¨ Phase 6: Special Cases"
echo "-------------------------"

# Specific component fixes
echo "ðŸ“ Fixing EntityHeader gradient..."
find features/wiki/components -name "EntityHeader.jsx" -type f -exec sed -i.bak \
    "s/from-\\\[var(--background)\\\] from-0% via-\\\[var(--background)\\\]\\/60 via-15% to-transparent/from-background via-background\\/60 to-transparent/g" {} \;

echo "ðŸ“ Fixing prose in EntityBody..."
find features/wiki/components -name "EntityBody.jsx" -type f -exec sed -i.bak \
    "s/prose-slate//g" {} \;

echo "ðŸ“ Fixing sidebar colors..."
find features/wiki/components -name "EntitySidebar.jsx" -type f -exec sed -i.bak \
    "s/text-stone-400/text-muted-foreground/g" {} \;

find features/wiki/components/navigation/sidebar -name "*.jsx" -type f -exec sed -i.bak \
    "s/text-stone-500/text-muted-foreground/g" {} \;

# Clean up all backup files
find features/ -name "*.bak" -type f -delete

echo ""
echo "âœ… Dark Mode Fix Complete!"
echo "=========================="
echo ""
echo "ðŸ“‹ Summary:"
echo "  - Replaced hardcoded text colors with semantic tokens"
echo "  - Updated background colors to theme-aware classes"
echo "  - Fixed border and divide colors"
echo "  - Applied special fixes to key components"
echo ""
echo "ðŸ” Next Steps:"
echo "  1. Review the changes in your components"
echo "  2. Test light, dark, and D&D themes"
echo "  3. Check for any remaining hardcoded colors"
echo "  4. Run your linter and fix any issues"
echo ""
echo "ðŸ’¡ Tips:"
echo "  - Use 'text-foreground' for primary text"
echo "  - Use 'text-muted-foreground' for secondary text"
echo "  - Use 'bg-muted' for subtle backgrounds"
echo "  - Use 'border-border' for all borders"
echo ""
--- END OF fix-dark-mode.sh ---

--- FILE: main.jsx ---
import React from 'react';
import ReactDOM from 'react-dom/client';
import { HashRouter } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import App from '@/app/App';
import '@/app/styles/global.css';
import 'leaflet/dist/leaflet.css';

const validateEnv = () => {
	const required = ['VITE_SUPABASE_URL', 'VITE_SUPABASE_ANON_KEY'];
	const missing = required.filter((key) => !import.meta.env[key]);
	if (missing.length > 0) {
		console.error('Missing required environment variables:', missing);
	}
};
validateEnv();

// CHANGED: Aggressive Caching Configuration
const queryClient = new QueryClient({
	defaultOptions: {
		queries: {
			// Data is considered fresh for 1 hour
			staleTime: 1000 * 60 * 60,
			// Keep unused data in memory for 24 hours
			cacheTime: 1000 * 60 * 60 * 24,
			refetchOnWindowFocus: false,
			refetchOnMount: false, // Don't refetch just because component remounted
			retry: 1,
		},
	},
});

ReactDOM.createRoot(document.getElementById('root')).render(
	<React.StrictMode>
		<QueryClientProvider client={queryClient}>
			<HashRouter>
				<App />
			</HashRouter>
		</QueryClientProvider>
	</React.StrictMode>
);

--- END OF main.jsx ---

